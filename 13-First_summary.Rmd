# First summary {#summary1}

```{r, include=FALSE}
if(knitr:::pandoc_to() == "html") {
  knitr::opts_chunk$set(echo = TRUE)
}else{
  knitr::opts_chunk$set(echo = FALSE)
}
```

## Introduction

A lot of code and parameterization has changed since the beginning of this book. Here is a little summary of all changes, starting with the outputs we have at this stage, followed with a step-by-step parameterization help for the new formalism.

```{r include=FALSE}
copy= file.copy(from = "Files/Auzeville_summary.html",to = "_book/Auzeville_summary.html")
```

## Model outputs

The model was tested on a series of experimentations on Wheat and Pea from Auzeville. It consists on a set of observations made on either sole crops or intercrops, and the model was run on each case to evaluate its simulation outputs. The model was also tested to simulate a sole crop as an intercrop with both plants from the same species and variety.  
The results of this evaluation are available on [this separate page](Auzeville_summary.html). 
You can consider this page as a snapshot of the evaluation of the model version used as : `r format(Sys.time(), '%d %B, %Y')`. This version of the model can be retrieved from my GIT repository using this SHA: `c9638aafb924949b630d273608d2b3c45369cd0c`.

## Model parameterization

### Height

The height can be computed using two different paradigms:

* The previous one, that uses the plant `lai` and foliar density (which depends also on the `lai`) to compute the plant width, and then uses a ratio to retrieve the plant height.  
* The new one that simply links the plant dry mass (`masec(n)`) to its height using an allometric relationship.

The computation is chosen using the `P_code_shape`. If `P_code_shape` is equal to `2`, the model will use the second one (using `masec`), and for any other value, it will use the first one.

The allometric equation is simply defined as:  
$hauteur= P_{hautbase} + P_{hautK} \cdot masec^{P_{hautA}}$  
So it has two new parameters: `P_hautK` and `P_hautA`. 
This equation is well known across a wide range of fields, can describe a large panel of relationships, is robust, and is quite simple to parameterize. In the case of STICS, the user should use sole crop data only for parameterization, because the hauteur~masec relationship is hard-coded for this situation. In the case of intercrop, the model will adapt the computation accordingly.

For our case experiment in Auzeville, these parameters were fitted thanks to the nls function in R using observations for each species independently.
```{r eval=FALSE}
obs_data.frame%>%
  nls(hauteur~K*masec^A,data = .,start = list(A=1,K=1))
```

At first, we were afraid that the relationship would differ according to the nitogen management, but only the dry mass was impacted by the nitrogen treatments, not the height~masec relationship. However, the relationship changed a little between sole crops and intercrops, but was still robust enough to use it as is as shown in the results from [this separate page](Auzeville_summary.html), also shown in the first paragraph.

### Equivalent density

The equivalent density is the density the plant would have if the other plant was of the same species, *i.e.* if the field was a sole crop. This equivalent density is used to compute the plant `LAI`. It is computed in three different ways in STICS, that are all described in Chapter \@ref(plantdensity). The third computation is re-explained here for ease:  

The third formalism is chosen by setting `P_code_calc_equi_density=3`. It is an improved computation to define the equivalent density as a function of the height difference between the plants, and using different parameters for intraspecific and interspecific competition, with simpler meanings. This formalism gives an equivalent density equal to the double of the true density to match a density equivalent to a sole crop, and increases this equivalent density until a given threshold (`hauteur_threshold`), after which a progressive increase in the equivalent density happen until the maximum allowed. In this computation, the slope is computed by the model, and the equivalent density is computed as follows:  
$density_{Equivalent} =\begin{cases}\Delta_{height} < hauteur_{threshold} & density_{p2} \\ \Delta_{height} > hauteur_{threshold} & b + \Delta_{height}\cdot slope \\ \Delta_{height} > hauteur_{threshold_2} & Max_{equDens} \end{cases}$  
with $slope= \frac{Max_{equDens}}{hauteur_{threshold_2}-hauteur_{threshold}}$.  

Hence, this formalism include three parameters (named here as used in the model):

* `P_hauteur_threshold`: the difference in height below which no competition is occuring
* `P_hauteur_threshold_2`: the difference in height below which a progressive competition is occuring
* `P_eqdens_max`: the maximum density allowed in intercrop, *i.e.* generally the sole crop density.

These three parameters are quite simple to parameterize also. The first one should be set to represent the moment the height difference between two plants start increasing competition. We set this parameter to 0.2 meters, because we considered no competition increase before a difference of 20 centimeters between both plants. The second threshold was set to 0.8 meters, because we considered the competition would increase linearly until this difference in height, reaching its maximum at this point. The `Max_equDens` was set to 240 for wheat and 60 for Pea. These densities correspond to a full density in a sole crop.

> Note: the increased equivalent density with height or whatever formalism used is only there to represent competitions comming from other processes than light interception, as it is already accounted for by the light interception subroutines. The model must be well parameterized for the light interception first, using no increase in equivalent density first (*e.g.* by setting a high `P_hauteur_threshold`), and then the equivalent density formalism can be used to better match the plants competition if needed.



