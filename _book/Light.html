<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>STICS intercrop: a work in progress for the ReMIX H2020 project</title>
  <meta name="description" content="This book is made to keep track of my work during my post-doctorate position for the ReMIX project.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="STICS intercrop: a work in progress for the ReMIX H2020 project" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is made to keep track of my work during my post-doctorate position for the ReMIX project." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="STICS intercrop: a work in progress for the ReMIX H2020 project" />
  
  <meta name="twitter:description" content="This book is made to keep track of my work during my post-doctorate position for the ReMIX project." />
  

<meta name="author" content="R. Vezy">


<meta name="date" content="2018-08-16">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="trg.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.7.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotlyjs-1.29.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotlyjs-1.29.2/plotly-latest.min.js"></script>

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">STICS intercrop: a work in progress for the ReMIX H2020 project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="Light.html"><a href="Light.html"><i class="fa fa-check"></i><b>2</b> Light Interception</a><ul>
<li class="chapter" data-level="2.1" data-path="Light.html"><a href="Light.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="Light.html"><a href="Light.html#plant-shape"><i class="fa fa-check"></i><b>2.2</b> Plant shape</a><ul>
<li class="chapter" data-level="2.2.1" data-path="Light.html"><a href="Light.html#plant-width-computation"><i class="fa fa-check"></i><b>2.2.1</b> Plant width computation</a></li>
<li class="chapter" data-level="2.2.2" data-path="Light.html"><a href="Light.html#plant-width-correction"><i class="fa fa-check"></i><b>2.2.2</b> Plant width correction</a></li>
<li class="chapter" data-level="2.2.3" data-path="Light.html"><a href="Light.html#plant-height"><i class="fa fa-check"></i><b>2.2.3</b> Plant height</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="Light.html"><a href="Light.html#light-interception"><i class="fa fa-check"></i><b>2.3</b> Light interception</a><ul>
<li class="chapter" data-level="2.3.1" data-path="Light.html"><a href="Light.html#incident-direct-radiation-from-the-atmosphere"><i class="fa fa-check"></i><b>2.3.1</b> Incident direct radiation from the atmosphere</a></li>
<li class="chapter" data-level="2.3.2" data-path="Light.html"><a href="Light.html#incident-diffuse-radiation-from-the-atmosphere"><i class="fa fa-check"></i><b>2.3.2</b> Incident diffuse radiation from the atmosphere</a></li>
<li class="chapter" data-level="2.3.3" data-path="Light.html"><a href="Light.html#total-diffuse-and-direct-radiation-from-the-atmosphere-incident-to-each-x-point"><i class="fa fa-check"></i><b>2.3.3</b> Total diffuse and direct radiation from the atmosphere incident to each X point</a></li>
<li class="chapter" data-level="2.3.4" data-path="Light.html"><a href="Light.html#light-tramsitted-by-the-dominant-crop-to-the-x-points"><i class="fa fa-check"></i><b>2.3.4</b> Light tramsitted by the dominant crop to the X points</a></li>
<li class="chapter" data-level="2.3.5" data-path="Light.html"><a href="Light.html#total-light-incident-to-x-points"><i class="fa fa-check"></i><b>2.3.5</b> Total light incident to X points</a></li>
<li class="chapter" data-level="2.3.6" data-path="Light.html"><a href="Light.html#total-radiation-incident-to-the-plane"><i class="fa fa-check"></i><b>2.3.6</b> Total radiation incident to the plane</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="Light.html"><a href="Light.html#summary"><i class="fa fa-check"></i><b>2.4</b> Summary</a></li>
<li class="chapter" data-level="2.5" data-path="Light.html"><a href="Light.html#discussion-and-proposed-modifications"><i class="fa fa-check"></i><b>2.5</b> Discussion and proposed modifications</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="trg.html"><a href="trg.html"><i class="fa fa-check"></i><b>3</b> Light incident to the dominated crop (trg)</a><ul>
<li class="chapter" data-level="3.1" data-path="trg.html"><a href="trg.html#computing-the-trg-incident-to-the-dominated-plant"><i class="fa fa-check"></i><b>3.1</b> Computing the trg incident to the dominated plant</a></li>
<li class="chapter" data-level="3.2" data-path="trg.html"><a href="trg.html#proposed-solution"><i class="fa fa-check"></i><b>3.2</b> Proposed solution</a></li>
<li class="chapter" data-level="3.3" data-path="trg.html"><a href="trg.html#results"><i class="fa fa-check"></i><b>3.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="eai.html"><a href="eai.html"><i class="fa fa-check"></i><b>4</b> Wheat EAI parameterization</a><ul>
<li class="chapter" data-level="4.1" data-path="eai.html"><a href="eai.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="eai.html"><a href="eai.html#model-sensitivity-to-the-p_sea-parameter"><i class="fa fa-check"></i><b>4.2</b> Model sensitivity to the <code>P_sea</code> parameter</a></li>
<li class="chapter" data-level="4.3" data-path="eai.html"><a href="eai.html#parameterization-of-the-p_sea-parameter"><i class="fa fa-check"></i><b>4.3</b> Parameterization of the <code>P_sea</code> parameter</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="plantdensity.html"><a href="plantdensity.html"><i class="fa fa-check"></i><b>5</b> Plant density and equivalent plant density</a><ul>
<li class="chapter" data-level="5.1" data-path="plantdensity.html"><a href="plantdensity.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="plantdensity.html"><a href="plantdensity.html#the-density-effect-on-lai"><i class="fa fa-check"></i><b>5.2</b> The density effect on LAI</a></li>
<li class="chapter" data-level="5.3" data-path="plantdensity.html"><a href="plantdensity.html#the-equivalent-density"><i class="fa fa-check"></i><b>5.3</b> The equivalent density</a></li>
<li class="chapter" data-level="5.4" data-path="plantdensity.html"><a href="plantdensity.html#proposition-for-new-equivalent-density-formalism"><i class="fa fa-check"></i><b>5.4</b> Proposition for new equivalent density formalism</a><ul>
<li class="chapter" data-level="5.4.1" data-path="plantdensity.html"><a href="plantdensity.html#definition-of-the-different-propositions"><i class="fa fa-check"></i><b>5.4.1</b> Definition of the different propositions</a></li>
<li class="chapter" data-level="5.4.2" data-path="plantdensity.html"><a href="plantdensity.html#visual-representation-of-the-options"><i class="fa fa-check"></i><b>5.4.2</b> Visual representation of the options</a></li>
<li class="chapter" data-level="5.4.3" data-path="plantdensity.html"><a href="plantdensity.html#comparison-between-options"><i class="fa fa-check"></i><b>5.4.3</b> Comparison between options</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Interrow.html"><a href="Interrow.html"><i class="fa fa-check"></i><b>6</b> Interrow spacing</a><ul>
<li class="chapter" data-level="6.1" data-path="Interrow.html"><a href="Interrow.html#introduction-3"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="Interrow.html"><a href="Interrow.html#inter-row-spacing-for-mixed-crops-in-the-model"><i class="fa fa-check"></i><b>6.2</b> Inter-row spacing for mixed crops in the model</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="design.html"><a href="design.html"><i class="fa fa-check"></i><b>7</b> Design</a><ul>
<li class="chapter" data-level="7.1" data-path="design.html"><a href="design.html#introduction-4"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="design.html"><a href="design.html#designs-that-can-be-simulated"><i class="fa fa-check"></i><b>7.2</b> Designs that can be simulated</a></li>
<li class="chapter" data-level="7.3" data-path="design.html"><a href="design.html#designs-that-cannot-be-simulated"><i class="fa fa-check"></i><b>7.3</b> Designs that cannot be simulated</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="LAIissue.html"><a href="LAIissue.html"><i class="fa fa-check"></i><b>8</b> Issue on LAI not decreasing</a><ul>
<li class="chapter" data-level="8.1" data-path="LAIissue.html"><a href="LAIissue.html#introduction-5"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="LAIissue.html"><a href="LAIissue.html#investigating-the-sla-hypothesis"><i class="fa fa-check"></i><b>8.2</b> Investigating the sla hypothesis</a></li>
<li class="chapter" data-level="8.3" data-path="LAIissue.html"><a href="LAIissue.html#leaf-senescence"><i class="fa fa-check"></i><b>8.3</b> Leaf senescence</a><ul>
<li class="chapter" data-level="8.3.1" data-path="LAIissue.html"><a href="LAIissue.html#leaf-lifespan"><i class="fa fa-check"></i><b>8.3.1</b> Leaf lifespan</a></li>
<li class="chapter" data-level="8.3.2" data-path="LAIissue.html"><a href="LAIissue.html#stress-indices"><i class="fa fa-check"></i><b>8.3.2</b> Stress indices</a></li>
<li class="chapter" data-level="8.3.3" data-path="LAIissue.html"><a href="LAIissue.html#over-fertilization"><i class="fa fa-check"></i><b>8.3.3</b> Over-fertilization</a></li>
<li class="chapter" data-level="8.3.4" data-path="LAIissue.html"><a href="LAIissue.html#de-activating-water-and-nitrogen-stresses"><i class="fa fa-check"></i><b>8.3.4</b> De-activating water and nitrogen stresses</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="LAIissue.html"><a href="LAIissue.html#the-solution-to-the-first-issue"><i class="fa fa-check"></i><b>8.4</b> The solution to the first issue</a></li>
<li class="chapter" data-level="8.5" data-path="LAIissue.html"><a href="LAIissue.html#fixing-a-second-issue"><i class="fa fa-check"></i><b>8.5</b> Fixing a second issue</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="FAPARissue.html"><a href="FAPARissue.html"><i class="fa fa-check"></i><b>9</b> Issue on FaPAR greater than one</a><ul>
<li class="chapter" data-level="9.1" data-path="FAPARissue.html"><a href="FAPARissue.html#introduction-6"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="FAPARissue.html"><a href="FAPARissue.html#the-solution-to-the-problem"><i class="fa fa-check"></i><b>9.2</b> The solution to the problem</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="height.html"><a href="height.html"><i class="fa fa-check"></i><b>10</b> Computing plant height</a><ul>
<li class="chapter" data-level="10.1" data-path="height.html"><a href="height.html#introduction-7"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="height.html"><a href="height.html#link-between-height-and-lai-and-dry-mass"><i class="fa fa-check"></i><b>10.2</b> Link between height and lai and dry mass</a></li>
<li class="chapter" data-level="10.3" data-path="height.html"><a href="height.html#computing-plant-height"><i class="fa fa-check"></i><b>10.3</b> Computing plant height</a><ul>
<li class="chapter" data-level="10.3.1" data-path="height.html"><a href="height.html#observations"><i class="fa fa-check"></i><b>10.3.1</b> Observations</a></li>
<li class="chapter" data-level="10.3.2" data-path="height.html"><a href="height.html#stresses"><i class="fa fa-check"></i><b>10.3.2</b> Stresses</a></li>
<li class="chapter" data-level="10.3.3" data-path="height.html"><a href="height.html#computation"><i class="fa fa-check"></i><b>10.3.3</b> Computation</a></li>
<li class="chapter" data-level="10.3.4" data-path="height.html"><a href="height.html#results-1"><i class="fa fa-check"></i><b>10.3.4</b> Results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="stages.html"><a href="stages.html"><i class="fa fa-check"></i><b>11</b> Developpment stages and LAI dynamic</a><ul>
<li class="chapter" data-level="11.1" data-path="stages.html"><a href="stages.html#introduction-8"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="stages.html"><a href="stages.html#checking-the-ilev"><i class="fa fa-check"></i><b>11.2</b> Checking the ilev</a></li>
<li class="chapter" data-level="11.3" data-path="stages.html"><a href="stages.html#checking-laicomp"><i class="fa fa-check"></i><b>11.3</b> Checking laicomp</a></li>
<li class="chapter" data-level="11.4" data-path="stages.html"><a href="stages.html#comparing-simulated-and-observed-lai-and-masec-in-self-ic"><i class="fa fa-check"></i><b>11.4</b> Comparing simulated and observed lai and masec in self-IC</a></li>
<li class="chapter" data-level="11.5" data-path="stages.html"><a href="stages.html#checking-durviei"><i class="fa fa-check"></i><b>11.5</b> Checking durvieI</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="LAItoohigh.html"><a href="LAItoohigh.html"><i class="fa fa-check"></i><b>12</b> The LAI in intercropping is too high</a><ul>
<li class="chapter" data-level="12.1" data-path="LAItoohigh.html"><a href="LAItoohigh.html#introduction-9"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="LAItoohigh.html"><a href="LAItoohigh.html#investigating-the-ulai-hypothesis"><i class="fa fa-check"></i><b>12.2</b> Investigating the <code>ulai</code> hypothesis</a></li>
<li class="chapter" data-level="12.3" data-path="LAItoohigh.html"><a href="LAItoohigh.html#investigating-the-density-hypothesis"><i class="fa fa-check"></i><b>12.3</b> Investigating the density hypothesis</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="misc.html"><a href="misc.html"><i class="fa fa-check"></i><b>13</b> Miscellaneous</a><ul>
<li class="chapter" data-level="13.1" data-path="misc.html"><a href="misc.html#introduction-10"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="misc.html"><a href="misc.html#extra-code-from-transrad"><i class="fa fa-check"></i><b>13.2</b> Extra code from transrad</a></li>
<li class="chapter" data-level="13.3" data-path="misc.html"><a href="misc.html#sowing-density-in-auzeville"><i class="fa fa-check"></i><b>13.3</b> Sowing density in Auzeville</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STICS intercrop: a work in progress for the ReMIX H2020 project</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Light" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Light Interception</h1>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">2.1</span> Introduction</h2>
<p>In STICS, the light interception is either computed using a simple Beer law assuming a homogeneous, turbid canopy, or a radiation transfer model that consider the plants leaf area index, canopy shape, height and density. The Beer law option is very simple but generally fairly accurate for high density homogeneous crops, but may rapidly yield unsatisfying predictions for stands with higher structural complexity (e.g. perennial plantations or mixed crops). For mixed crops, the model uses the radiation transfer model in a particular manner that is described in further details below.</p>
<p>For the case of intercrops, the model first set the taller crop as “dominant”, and the shorter crop as “dominated”. The model then compute the radiation interception of each one according to the dominancy, the structure (height, width, light extinction coefficient…) and position (interrow distance, row orientation) of the species. Of course, the dominancy of each plant species can be inverted if the dominated plant become taller than the dominant plant, and the model checks every day for such a case.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">j=<span class="dv">1</span>              <span class="co"># julian day (DOY= Day Of Year)</span>
ir=<span class="st"> </span><span class="dv">1</span>            <span class="co"># Interrow distance</span>
l=<span class="st"> </span><span class="fl">0.2</span>           <span class="co"># Width of the plant crown</span>
rap=<span class="st"> </span><span class="fl">0.5</span>         <span class="co"># Thickness to width ratio</span>
haut=<span class="st"> </span><span class="dv">1</span>.         <span class="co"># Height of the part of the dominant plant above the dominated plant</span>
                 <span class="co"># = hauteurzero = P_hautbase-originehaut</span>
                 <span class="co"># with originehaut= dominated plant height</span>
P_forme=<span class="st"> </span><span class="dv">1</span>       <span class="co"># Plant shape code (1= rectangle, 2= upside triangle, 3= downside tr.)</span>
alpha=<span class="st"> </span><span class="dv">0</span>         <span class="co"># Row orientation</span>
lat=<span class="st"> </span><span class="fl">43.61</span>       <span class="co"># Latitude in degrees</span>
trg=<span class="st"> </span><span class="dv">25</span>          <span class="co"># Global radiation</span>
rdif=<span class="st"> </span><span class="fl">0.4</span>        <span class="co"># Diffuse fraction of the atmospheric radiation</span>
P_ktrou=<span class="st"> </span><span class="fl">0.2</span>     <span class="co"># Light extinction coefficient of the dominant plant</span>
lai=<span class="st"> </span><span class="dv">2</span>           <span class="co"># Leaf area index of the dominant plant</span>
eai=<span class="st"> </span><span class="dv">0</span>           <span class="co"># Equivalent leaf area index, = photosynthetic surface that is not from</span>
<span class="co"># leaves (e.g. wheat ears, rapeseed siliquae, pea pods or grapes during their green stage)</span></code></pre></div>
<p>To facilitate understanding, we will use a common intercrop example throughout the whole document. We take a mixed crop simulated for the day of the year 1 with a global radiation of 25 MJ m-2 day-1 (= 12 MJ m-2 day-1 of PAR), and a diffuse fraction of light of 0.4, an interrow spacing of 1 meter, a shape of 1 (1= rectangle, 2= upside triangle and 3= downside rectangle), a canopy width of 0.2 meter, a canopy thickness of 0.1 meter, a row orientation of 0 relative to the North-South axis at latitude 43.61 degrees north, an LAI of 2, a light extinction coefficient of 0.2. The canopy of the dominant plant is 1 meter above the dominated plant. All code used in this document can be viewed in each section by clicking on the <code>Code</code> button on the right.</p>
</div>
<div id="plant-shape" class="section level2">
<h2><span class="header-section-number">2.2</span> Plant shape</h2>
<p>Each plant radiation interception is computed using an approximation of its shape (<code>P_forme</code>= 1, rectangle, = 2 upside triangle, = 3 downside triangle), leaf area index (<code>lai</code> or <code>p(i)%lai(ens,n)</code>), height, width, density at emergence and leaf area density (<code>dfol</code>).</p>
<div id="plant-width-computation" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Plant width computation</h3>
<p>First, the plant width is computed using the <code>formplante</code> function. This computation is possible thanks to the relationship between two ways for computing the plant leaf area, where one of them uses the plant width:</p>
<ul>
<li><p>First, assuming the plant has a square footprint (i.e. plant projection is square), we can find the plant leaf area using the leaf area index (<code>lai</code>) and the plant density:<br />
<span class="math inline">\(LA=\frac{\left(lai+laisen+eai\right)}{densite}\)</span> which is the equivalent to: <span class="math inline">\(LA=\left(lai+laisen+eai\right)\cdot interrang\cdot distrang\)</span><br />
where <code>lai</code> is the leaf area index, <code>laisen</code> is the senescent leaf area index, <code>eai</code> is the equivalent leaf area of the photosynthetic organs that are not leaves (e.g. flower buds), <code>interrang</code> is the inter-row spacing and <code>distrang</code> the intra-row distance.</p></li>
<li><p>Second, using the leaf area density and the plant volume such as:<br />
<span class="math inline">\(LA=dfol\cdot largeur\cdot epaisseur\cdot profondeur\)</span> for a cuboid and <span class="math inline">\(LA=dfol\cdot\frac{1}{2}\cdot\left(largeur\cdot epaisseur\cdot profondeur\right)\)</span> for a triangular prism, where <code>dfol</code> is the leaf area density, <code>largeur</code> is the <strong>plant width</strong> (also called <code>largtrans</code>), <code>epaisseur</code> is the plant thickness and <code>profondeur</code> is the plant depth.</p></li>
</ul>
<p>Knowing both equations, and assuming the two following hypothesis:</p>
<ol style="list-style-type: decimal">
<li>The plant depth is equal to the plant width</li>
<li>The intra-row distance between two plants is equal to the plant width</li>
</ol>
<p>We can now compute the plant width as:<br />
<span class="math inline">\(largeur=\sqrt{\frac{(lai+laisen+eai)\cdot interrang}{dfol\cdot varrapforme}}\)</span></p>
<p>where <code>varrapforme</code> (or <code>raptrans</code> further) is the ratio between the plant thickness and width and is computed as <span class="math inline">\(varrapforme=\frac{(hauteur-P_{hautbase})}{largeur}\)</span> where <code>hauteur</code> is the total plant height, <code>P_hautbase</code> is the plant (i.e. crown) base height and <code>largeur</code> is the plant width (see fig <a href="Light.html#fig:Width">2.1</a> for more details)</p>
<div class="figure"><span id="fig:Width"></span>
<img src="img/Light-interception-dominant-1.png" alt="Diagram representing the different parameters used to compute plant width. The different names used in the model are shown between parenthesis" />
<p class="caption">Figure 2.1: <strong>Diagram representing the different parameters used to compute plant width. The different names used in the model are shown between parenthesis</strong></p>
</div>
</div>
<div id="plant-width-correction" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Plant width correction</h3>
<p>If the dominated plant is higher than the base height of the dominant plant, the radiation interception of the dominant plant is partially reduced, by reducing the volume that can intercept light to the canopy volume above the dominated plant only. This correction is made to consider the competition for light between the two species, and is computed according to the shape of the plant.</p>
<p>Consequently, the model first compute the height of the dominated plant (<code>sc%originehaut</code>) by looking for the maximum height between the sunlit and shaded part of the dominated plant:<br />
<code>sc%originehaut = max(p(i+1)%hauteur(sc%AO),p(i+1)%hauteur(sc%AS))</code></p>
<blockquote>
<p><code>sc%originehaut</code> is fixed to <code>0</code> (= soil) while computing the dominated plant.</p>
</blockquote>
<p>Hence, the new thickness (<code>enouv</code>) is computed as: <span class="math inline">\(enouv=largeur\cdot\left|varrapforme\right|+hauteurzero\)</span>, and is used to re-compute the shape of the plant:</p>
<ul>
<li>The new thickness to width ratio (<code>raptrans</code>, formerly <code>varrapforme</code>): <span class="math inline">\(raptrans=\frac{enouv}{largeur}\)</span> for rectangle shaped plants,</li>
<li>The new width (<code>largtrans</code>, formerly <code>largeur</code>): <span class="math inline">\(largtrans=\frac{enouv}{varrapforme}\)</span> for upsided triangle shaped plants,</li>
<li>The new width (<code>largtrans</code>, formerly <code>largeur</code>): <span class="math inline">\(raptrans=\frac{enouv}{largtrans}\)</span> for downsided triangle shaped plants,</li>
</ul>
<p>All variable names are changed, whether there is a correction or not. Here is a summary table:</p>
<table>
<caption><span id="tab:varmatch">Table 2.1: </span>Variable name modification in the formplante function</caption>
<thead>
<tr class="header">
<th align="left">Original</th>
<th align="left">Modified</th>
<th align="left">Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">hauteur</td>
<td align="left">hauteur</td>
<td align="left">Height</td>
</tr>
<tr class="even">
<td align="left">largeur</td>
<td align="left">largtrans</td>
<td align="left">Width</td>
</tr>
<tr class="odd">
<td align="left">varrapforme</td>
<td align="left">raptrans</td>
<td align="left">Thickness/Width Ratio</td>
</tr>
<tr class="even">
<td align="left">enouv</td>
<td align="left">enouv</td>
<td align="left">Thickness</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Upside triangle is a triangle with its base at the bottom, while downside triangle is a triangle with the base at the top.</p>
</blockquote>
<p>The correction of the shape of the plant can be summarised in the diagram Presented in Figure <a href="Light.html#fig:Comprad">2.2</a>.</p>
<div class="figure"><span id="fig:Comprad"></span>
<img src="img/Light-interception-dominant-2.png" alt="Competition for radiation interception of the dominant plant induced by a high dominated plant" />
<p class="caption">Figure 2.2: <strong>Competition for radiation interception of the dominant plant induced by a high dominated plant</strong></p>
</div>
<p>The correction of the shape of the plant is only used to compute the light transmitted to a plane at the dominated plant or soil height. The targeted plant interception is computed using its whole leaf area index and a light extinction coefficient.</p>
</div>
<div id="plant-height" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Plant height</h3>
<p>The plant height is simply computed using the plant base height, its width, and the thickness to width ratio:</p>
<p><span class="math inline">\(hauteur=P_{hautbase}+largeur\cdot\left|varrapforme\right|\)</span></p>
<p>So indirectly, the plant height depends on its <code>LAI</code>, because the plant width is computed using it in the first place. This formalism maybe not optimal, because the plant <code>height</code> and <code>LAI</code> are not well related during advanced plant physiological stages.</p>
</div>
</div>
<div id="light-interception" class="section level2">
<h2><span class="header-section-number">2.3</span> Light interception</h2>
<p>The light intercepted by a plant species is obtained by computing the light reaching a horizontal plane below its canopy, either at the height of the dominated plant (for the dominant plant) of the soil (for the dominated plant). Therefore, the light incident on this plane is either coming from:</p>
<ul>
<li>The incident light coming from the atmosphere, divided into two components, namely the diffuse and direct light. This light is called <code>rdroit</code> in the model,</li>
<li>The light transmitted by the dominant crop, which is called <code>rtrans</code>, and that is generally of lower quality for photosynthesis. The effect of light quality is wrapped in the equivalent density formalism, see Chapter <a href="plantdensity.html#plantdensity">5</a> for more details.</li>
</ul>
<p>Consequently, numerous points (20, or 200 if the inter-row is lower than 1 m) are equally distributed every meter along the inter-row (<em>i.e.</em> one point every 5 cm, or every 0.5 cm with 200 points), at the height of the plane. These points are used to discretize the computation of the incident light at the surface of the plane.<br />
Hence, the total number of points to simulate is computed using the <code>interval</code> parameter, which is equal to 200 if the inter-row is lower than 1 meter or 20 if more. It is then used to compute the total number of points to simulate as: <span class="math inline">\(N_{points}=\frac{ir}{2}\cdot interval\)</span></p>
<blockquote>
<p>In practice, the model really simulates only half of the inter-row, because it is considered that the other half have the same light conditions at daily time-scale. For example, if we take an interrow of 10 meters, the model simulates 100 points equally distributed from 0 to 5 meters.</p>
</blockquote>
<p>Here is an example of the X position on the plane, starting from the left-hand side of the row, using an inter-row spacing of 1 meter and a plant width of 0.2 meter:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span>(ir<span class="op">&lt;</span><span class="fl">1.0</span>){
  interval =<span class="st"> </span><span class="dv">200</span>
}<span class="cf">else</span>{
  interval =<span class="st"> </span><span class="dv">20</span>.
}
i=<span class="st"> </span><span class="dv">1</span><span class="op">:</span>(ir <span class="op">/</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>interval)
x=<span class="st"> </span>(i<span class="op">-</span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>interval
<span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">&quot;x=&quot;</span>, <span class="kw">paste</span>(x, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>)))</code></pre></div>
<p>x= 0, 0.05, 0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45</p>
<p>The points are then divided into two groups :</p>
<ul>
<li>The sunlit points, which are located directly under the crown of the targeted crop.</li>
<li>The shaded points, which are not directly under the crop crown, <em>i.e.</em> they have the sky above them.</li>
</ul>
<p>Then the semi-hemisphere above each point is discretized onto 2 x 23 angles: 23 angles from top to right, and 23 angles from top to left. These angles are used to compute <code>kgdiffus</code>, the atmospheric diffuse radiation incident to the X point. However, if the X point is below the targeted crop canopy (<code>X&lt;l/2</code>), only the 23 angles from the top to the right are used to compute <code>kgdiffus</code> (considering that Xs are only computed from the left-hand plants row until the middle of the inter-row, see fig.<a href="Light.html#fig:Compdominated">2.3</a> for more details).</p>
<p>The model determines the two angles (<span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span>) between which the point only receive incident light coming from the atmosphere (<code>rdroit</code>). Using these two angles (or their tangent, <code>G</code>), the model computes:</p>
<ol style="list-style-type: decimal">
<li>The daily direct radiation (i.e. cumulated hourly radiation) that is incoming only during the time period between two hours (<code>h1</code> and <code>h2</code>) when the sun angle is between <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span>. Function <code>kgeom</code> called in <code>rtrans</code>.</li>
<li>The incident diffuse radiation for all angles between <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span>. Function <code>kdiff</code> called in <code>rtrans</code>.</li>
<li>The light transmitted to the plane by the target crop for all angles below <span class="math inline">\(\theta_1\)</span> or above <span class="math inline">\(\theta_2\)</span>.</li>
</ol>
<blockquote>
<p>In practice, all points with an x position lower than <span class="math inline">\(\frac{largeur}{2}\)</span> are shaded, and all other are sunlit, so the model computes the diffuse radiation coming from the atmosphere only for one quarter of the hemisphere for shaded Xs ; the other quarter will receive transmitted light because all angles are superior to <span class="math inline">\(\theta_2\)</span>.</p>
</blockquote>
<blockquote>
<p>Main functions used are <code>transrad</code>, <code>rtrans</code>, <code>kdiff</code> and <code>kgeom</code>.</p>
</blockquote>
<p>The position of <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span> (and their tangent) depends from three components: the crop shape, its inter-row spacing, and the sun azimuth (see fig. <a href="Light.html#fig:Compdominated">2.3</a>).</p>
<div class="figure"><span id="fig:Compdominated"></span>
<img src="img/Light-interception-dominated.png" alt="Diagram of the computation workflow of STICS for radiation interception for two X points placed above the dominated plant species. a. The X point is considered sunlit; b. The X point is considered shaded (right under the dominant plant canopy), so only the right-hand side of the semi-hemisphere is computed for atmospheric radiation" />
<p class="caption">Figure 2.3: <strong>Diagram of the computation workflow of STICS for radiation interception for two X points placed above the dominated plant species. a. The X point is considered sunlit; b. The X point is considered shaded (right under the dominant plant canopy), so only the right-hand side of the semi-hemisphere is computed for atmospheric radiation</strong></p>
</div>
<div id="incident-direct-radiation-from-the-atmosphere" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Incident direct radiation from the atmosphere</h3>
<p>The incident direct radiation for each X point is computed for all angles of the hemisphere between <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span> (see <a href="Light.html#fig:Compdominated">2.3</a>), and summed up to integrate the semi-hemisphere of each point.</p>
<p>Here is an example of the computation of the direct proportion received at each X point for a crop using the <code>kgeom()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">decangle=<span class="st"> </span><span class="cf">function</span>(j){
  theta1 =<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi <span class="op">*</span><span class="st"> </span>(j <span class="op">-</span><span class="st"> </span><span class="dv">80</span>) <span class="op">/</span><span class="st"> </span><span class="dv">365</span>
  theta2 =<span class="st"> </span><span class="fl">0.034</span> <span class="op">*</span><span class="st"> </span>(<span class="kw">sin</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi <span class="op">*</span><span class="st"> </span>j <span class="op">/</span><span class="st"> </span><span class="dv">365</span>) <span class="op">-</span><span class="st"> </span><span class="kw">sin</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi <span class="op">*</span><span class="st"> </span><span class="dv">80</span> <span class="op">/</span><span class="st"> </span><span class="dv">365</span>))
  theta =<span class="st"> </span>theta1 <span class="op">-</span><span class="st"> </span>theta2
  decangle =<span class="st"> </span><span class="kw">asin</span>(<span class="fl">0.3978</span> <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(theta))
}

thetacrit=<span class="st"> </span><span class="cf">function</span>(lat,j,tgh,alpha){
  
  acrit =<span class="st"> </span><span class="fl">0.0</span>
  bcrit =<span class="st"> </span><span class="fl">0.0</span>
  a =<span class="st"> </span><span class="fl">0.0</span>
  b =<span class="st"> </span><span class="fl">0.0</span>
  thetacr =<span class="st"> </span><span class="fl">0.0</span>
  hcritprec=<span class="st"> </span><span class="dv">0</span>
  n  =<span class="st"> </span><span class="dv">3</span>
  dec =<span class="st"> </span><span class="kw">decangle</span>(j)
  hprec =<span class="st"> </span><span class="fl">0.0</span>
  pi =<span class="st"> </span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span><span class="kw">atan</span>(<span class="fl">1.0</span>)
  theta=<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">180</span>)
  
  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="dv">18</span> <span class="op">*</span><span class="st"> </span>n)){
    theta[i] =<span class="st"> </span><span class="dv">10</span>. <span class="op">/</span><span class="st"> </span>n <span class="op">*</span><span class="st"> </span>(i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)
    theta[i] =<span class="st"> </span>(theta[i] <span class="op">-</span><span class="st"> </span><span class="dv">90</span>) <span class="op">/</span><span class="st"> </span><span class="dv">180</span> <span class="op">*</span><span class="st"> </span>pi
    <span class="co"># Sun position (h,azim)</span>
    sinh =<span class="st"> </span><span class="kw">sin</span>(lat) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(dec) <span class="op">+</span><span class="st"> </span><span class="kw">cos</span>(lat) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(dec) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(theta[i])
    h =<span class="st"> </span><span class="kw">asin</span>(sinh)
    cosazim =<span class="st"> </span>(<span class="op">-</span><span class="kw">cos</span>(lat) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(dec) <span class="op">+</span><span class="st"> </span><span class="kw">sin</span>(lat) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(dec) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(theta[i])) <span class="op">/</span><span class="st"> </span><span class="kw">cos</span>(h)
    cosazim =<span class="st"> </span><span class="kw">pmin</span>(<span class="fl">1.0</span>,cosazim)
    <span class="cf">if</span>(theta[i]<span class="op">!=</span><span class="fl">0.0</span>){
      azim =<span class="st"> </span><span class="kw">acos</span>(cosazim) <span class="op">*</span><span class="st"> </span>theta[i] <span class="op">/</span><span class="st"> </span><span class="kw">abs</span>(theta[i])
    }<span class="cf">else</span>{
      azim =<span class="st"> </span><span class="fl">0.0</span>
    }
    <span class="cf">if</span>(sinh<span class="op">&lt;</span><span class="fl">0.0</span>){h =<span class="st"> </span><span class="fl">0.0</span>}
    
    <span class="co"># Critical height</span>
    hcrit =<span class="st"> </span><span class="kw">atan</span>(tgh <span class="op">*</span><span class="st"> </span><span class="kw">abs</span>(<span class="kw">sin</span>(azim <span class="op">+</span><span class="st"> </span>alpha <span class="op">+</span><span class="st"> </span><span class="fl">0.00001</span>)))
    <span class="co"># test for h = hcrit</span>
    <span class="cf">if</span> (hcritprec <span class="op">&gt;=</span><span class="st"> </span>hprec <span class="op">&amp;</span><span class="st"> </span>hcrit <span class="op">&lt;=</span><span class="st"> </span>h <span class="op">&amp;</span><span class="st"> </span>i <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>){
      <span class="co"># Linear interpolation:</span>
      acrit =<span class="st"> </span>(hcrit <span class="op">-</span><span class="st"> </span>hcritprec) <span class="op">/</span><span class="st"> </span>(theta[i] <span class="op">-</span><span class="st"> </span>theta[i<span class="op">-</span><span class="dv">1</span>])
      bcrit =<span class="st"> </span>hcrit <span class="op">-</span><span class="st"> </span>acrit <span class="op">*</span><span class="st"> </span>theta[i]
      a =<span class="st"> </span>(h <span class="op">-</span><span class="st"> </span>hprec) <span class="op">/</span><span class="st"> </span>(theta[i] <span class="op">-</span><span class="st"> </span>theta[i<span class="op">-</span><span class="dv">1</span>])
      b =<span class="st"> </span>h <span class="op">-</span><span class="st"> </span>a <span class="op">*</span><span class="st"> </span>theta[i]
      
      <span class="cf">if</span>(a<span class="op">!=</span>acrit){thetacr =<span class="st"> </span>(b <span class="op">-</span><span class="st"> </span>bcrit) <span class="op">/</span><span class="st"> </span>(acrit <span class="op">-</span><span class="st"> </span>a)}
      hcritprec =<span class="st"> </span>hcrit
      hprec =<span class="st"> </span>h
    }
  }
  <span class="kw">return</span>(thetacr)
}

e =<span class="st"> </span><span class="kw">abs</span>(l <span class="op">*</span><span class="st"> </span>rap) <span class="co"># Thickness of the plant crown</span>
xprec=<span class="st"> </span><span class="dv">0</span>         <span class="co"># Init.</span>
limite =<span class="st"> </span>l <span class="op">/</span><span class="st"> </span><span class="dv">2</span>

<span class="cf">if</span>(ir<span class="op">&lt;</span><span class="fl">1.0</span>){interval =<span class="st"> </span><span class="dv">200</span>.}<span class="cf">else</span>{interval =<span class="st"> </span><span class="dv">20</span>.}
<span class="cf">if</span>(l<span class="op">&gt;</span>ir<span class="op">/</span><span class="dv">2</span>.){l =<span class="st"> </span>ir<span class="op">/</span><span class="dv">2</span>.}

<span class="cf">if</span>(e<span class="op">&gt;</span><span class="fl">0.0</span>){
  limite2 =<span class="st"> </span>l<span class="op">/</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(haut<span class="op">/</span>e<span class="op">+</span><span class="dv">1</span>)
}<span class="cf">else</span>{
  P_forme =<span class="st"> </span><span class="dv">1</span>
}
<span class="co"># NB : is it sure that it is (haut/e+1) and not (haut/(e+1)) ? </span>

<span class="co"># Saving some intermediate results for output here (not in the real function):</span>
x_s=<span class="st"> </span>(<span class="dv">1</span><span class="op">:</span>(ir <span class="op">/</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>interval))
Output=<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x_index=</span> x_s,
                   <span class="dt">x_value=</span> (x_s<span class="op">-</span><span class="dv">1</span>)<span class="op">/</span>interval,
                   <span class="dt">theta1=</span> <span class="kw">rep</span>(<span class="ot">NA_real_</span>,<span class="kw">length</span>(x_s)),
                   <span class="dt">theta2=</span> <span class="kw">rep</span>(<span class="ot">NA_real_</span>,<span class="kw">length</span>(x_s)),
                   <span class="dt">theta1_deg=</span> <span class="kw">rep</span>(<span class="ot">NA_real_</span>,<span class="kw">length</span>(x_s)),
                   <span class="dt">theta2_deg=</span> <span class="kw">rep</span>(<span class="ot">NA_real_</span>,<span class="kw">length</span>(x_s)),
                   <span class="dt">kg=</span> <span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(x_s)))

<span class="co"># Loop over Xs:</span>

<span class="cf">for</span>(i <span class="cf">in</span> x_s){
  x =<span class="st"> </span>(i<span class="op">-</span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>interval
  <span class="cf">if</span>(xprec<span class="op">&lt;=</span>l<span class="op">/</span><span class="dv">2</span><span class="op">&amp;</span>x<span class="op">&gt;=</span>l<span class="op">/</span><span class="dv">2</span>){ilim =<span class="st"> </span>i}
  xprec =<span class="st"> </span>x
  
  <span class="co"># kdir:</span>
  
  <span class="co"># Rectangle:</span>
  <span class="cf">if</span>(P_forme<span class="op">==</span><span class="dv">1</span>){
    tgh1 =<span class="st"> </span>(haut <span class="op">+</span><span class="st"> </span>e) <span class="op">/</span><span class="st"> </span>(ir <span class="op">-</span><span class="st"> </span>x <span class="op">-</span><span class="st"> </span>limite)
    theta1 =<span class="st"> </span><span class="kw">thetacrit</span>(lat,j,tgh1,alpha)
    <span class="cf">if</span>(x<span class="op">&gt;</span>limite){
      tgh2 =<span class="st"> </span>(haut <span class="op">+</span><span class="st"> </span>e) <span class="op">/</span><span class="st"> </span>(x <span class="op">-</span><span class="st"> </span>limite)
      theta2 =<span class="st"> </span><span class="kw">thetacrit</span>(lat,j,tgh2,alpha)
    }<span class="cf">else</span> <span class="cf">if</span>(x <span class="op">&lt;</span><span class="st"> </span>limite){
      tgh2 =<span class="st"> </span>haut <span class="op">/</span><span class="st"> </span>( <span class="op">-</span>x <span class="op">+</span><span class="st"> </span>limite)
      theta2 =<span class="st"> </span><span class="op">-</span><span class="kw">thetacrit</span>(lat,j,tgh2,alpha)
    }<span class="cf">else</span>{
      <span class="co"># x == limite</span>
      theta2 =<span class="st"> </span><span class="dv">0</span>
    }
  }
  
  <span class="co"># Downside Triangle:</span>
  <span class="cf">if</span> (P_forme<span class="op">==</span><span class="dv">2</span> <span class="op">&amp;</span><span class="st"> </span>rap<span class="op">&lt;</span><span class="dv">0</span>.){
    tgh1 =<span class="st"> </span>(haut <span class="op">+</span><span class="st"> </span>e) <span class="op">/</span><span class="st"> </span>(ir <span class="op">-</span><span class="st"> </span>x <span class="op">-</span><span class="st"> </span>limite)
    theta1 =<span class="st"> </span><span class="kw">thetacrit</span>(lat,j,tgh1,alpha)
    <span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span>limite){
      tgh2 =<span class="st"> </span>(haut <span class="op">+</span><span class="st"> </span>e) <span class="op">/</span><span class="st"> </span>(x <span class="op">-</span><span class="st"> </span>limite)
      theta2 =<span class="st"> </span><span class="kw">thetacrit</span>(lat,j,tgh2,alpha)
    }<span class="cf">else</span> <span class="cf">if</span>(x <span class="op">&lt;</span><span class="st"> </span>limite){
      tgh2 =<span class="st"> </span>(haut <span class="op">+</span><span class="st"> </span>e) <span class="op">/</span><span class="st"> </span>( x <span class="op">-</span><span class="st"> </span>limite)
      theta2 =<span class="st"> </span><span class="op">-</span><span class="kw">thetacrit</span>(lat,j,tgh2,alpha)
    }<span class="cf">else</span>{
      theta2 =<span class="st"> </span><span class="dv">0</span>
    }
  }
  
  <span class="co"># Upside Triangle:</span>
  <span class="cf">if</span> (P_forme<span class="op">==</span><span class="dv">2</span><span class="op">&amp;</span>rap<span class="op">&gt;</span><span class="dv">0</span>.){ then
    tgh1 =<span class="st"> </span>(haut <span class="op">+</span><span class="st"> </span>e) <span class="op">/</span><span class="st"> </span>(ir <span class="op">-</span><span class="st"> </span>x <span class="op">-</span><span class="st"> </span>limite)
    theta1 =<span class="st"> </span><span class="kw">thetacrit</span>(lat,j,tgh1,alpha)
    <span class="cf">if</span> (x <span class="op">&lt;</span><span class="st"> </span>limite2){
      <span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span>limite){
        tgh2 =<span class="st"> </span>haut <span class="op">/</span><span class="st"> </span>( x <span class="op">-</span><span class="st"> </span>limite)
        theta2 =<span class="st"> </span><span class="kw">thetacrit</span>(lat,j,tgh2,alpha)
      }<span class="cf">else</span> <span class="cf">if</span>(x <span class="op">&lt;</span><span class="st"> </span>limite){
        tgh2 =<span class="st"> </span>haut <span class="op">/</span><span class="st"> </span>(limite <span class="op">-</span><span class="st"> </span>x)
        theta2 =<span class="st"> </span><span class="op">-</span><span class="kw">thetacrit</span>(lat,j,tgh2,alpha)
      }<span class="cf">else</span>{
        theta2 =<span class="st"> </span><span class="fl">0.0</span>
      }
    }<span class="cf">else</span> <span class="cf">if</span>(x <span class="op">&gt;=</span><span class="st"> </span>limite2){
      tgh2 =<span class="st"> </span>(haut <span class="op">+</span><span class="st"> </span>e) <span class="op">/</span><span class="st"> </span>x
      theta2 =<span class="st"> </span><span class="kw">thetacrit</span>(lat,j,tgh2,alpha)
    }
  }
  
  <span class="co"># NB: is there a missing else here ? kg is modified just after...</span>
  <span class="cf">if</span>(e <span class="op">&gt;</span><span class="st"> </span><span class="fl">2.1e-2</span>){
    kg =<span class="st"> </span><span class="kw">cos</span>(theta1)
    kg =<span class="st"> </span><span class="kw">cos</span>(theta2)
  }
  kg =<span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span>(<span class="kw">cos</span>(pi<span class="op">/</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>theta1) <span class="op">+</span><span class="st"> </span><span class="kw">cos</span>(pi<span class="op">/</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>theta2))
  kg =<span class="st"> </span><span class="kw">max</span>(kg,<span class="fl">0.0</span>)
  
  Output<span class="op">$</span>theta1[Output<span class="op">$</span>x_index<span class="op">==</span>i]=<span class="st"> </span>theta1
  Output<span class="op">$</span>theta2[Output<span class="op">$</span>x_index<span class="op">==</span>i]=<span class="st"> </span>theta2
  Output<span class="op">$</span>kg[Output<span class="op">$</span>x_index<span class="op">==</span>i]=<span class="st"> </span>kg
}

Output<span class="op">$</span>theta1_deg=<span class="st"> </span>(pi<span class="op">/</span><span class="dv">2</span><span class="op">+</span>Output<span class="op">$</span>theta1)<span class="op">*</span><span class="dv">180</span><span class="op">/</span>pi
Output<span class="op">$</span>theta2_deg=<span class="st"> </span>(pi<span class="op">/</span><span class="dv">2</span><span class="op">-</span>Output<span class="op">$</span>theta2)<span class="op">*</span><span class="dv">180</span><span class="op">/</span>pi

<span class="kw">colnames</span>(Output)=<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;X index&quot;</span>,<span class="st">&quot;X value (m)&quot;</span>,<span class="st">&quot;Theta 1 (rad)&quot;</span>,<span class="st">&quot;Theta 2 (rad)&quot;</span>,
                    <span class="st">&quot;Theta 1 (deg)&quot;</span>,<span class="st">&quot;Theta 2 (deg)&quot;</span>,<span class="st">&quot;kgdirect&quot;</span>)

<span class="kw">kable</span>(Output, <span class="dt">caption=</span> <span class="kw">paste</span>(<span class="st">&quot;Example of the computation of the incident direct&quot;</span>,
                             <span class="st">&quot;radiation ratio kgdirect. See introduction section&quot;</span>,
                             <span class="st">&quot;for further details on the crop.&quot;</span>))</code></pre></div>
<table>
<caption><span id="tab:kdir">Table 2.2: </span>Example of the computation of the incident direct radiation ratio kgdirect. See introduction section for further details on the crop.</caption>
<thead>
<tr class="header">
<th align="right">X index</th>
<th align="right">X value (m)</th>
<th align="right">Theta 1 (rad)</th>
<th align="right">Theta 2 (rad)</th>
<th align="right">Theta 1 (deg)</th>
<th align="right">Theta 2 (deg)</th>
<th align="right">kgdirect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.00</td>
<td align="right">-0.7563093</td>
<td align="right">0.1163553</td>
<td align="right">46.66667</td>
<td align="right">83.33333</td>
<td align="right">0.2850744</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.05</td>
<td align="right">-0.7563093</td>
<td align="right">0.0581776</td>
<td align="right">46.66667</td>
<td align="right">86.66667</td>
<td align="right">0.3140484</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.10</td>
<td align="right">-0.6981317</td>
<td align="right">0.0000000</td>
<td align="right">50.00000</td>
<td align="right">90.00000</td>
<td align="right">0.3213938</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.15</td>
<td align="right">-0.6981317</td>
<td align="right">-0.0581776</td>
<td align="right">50.00000</td>
<td align="right">93.33333</td>
<td align="right">0.3504662</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.20</td>
<td align="right">-0.6399541</td>
<td align="right">-0.1163553</td>
<td align="right">53.33333</td>
<td align="right">96.66667</td>
<td align="right">0.3566258</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.25</td>
<td align="right">-0.6399541</td>
<td align="right">-0.1745329</td>
<td align="right">53.33333</td>
<td align="right">100.00000</td>
<td align="right">0.3854034</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">0.30</td>
<td align="right">-0.5817764</td>
<td align="right">-0.2327106</td>
<td align="right">56.66667</td>
<td align="right">103.33333</td>
<td align="right">0.3900624</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.35</td>
<td align="right">-0.5235988</td>
<td align="right">-0.2908882</td>
<td align="right">60.00000</td>
<td align="right">106.66667</td>
<td align="right">0.3934016</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">0.40</td>
<td align="right">-0.4654211</td>
<td align="right">-0.2908882</td>
<td align="right">63.33333</td>
<td align="right">106.66667</td>
<td align="right">0.3678012</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">0.45</td>
<td align="right">-0.4654211</td>
<td align="right">-0.3490659</td>
<td align="right">63.33333</td>
<td align="right">110.00000</td>
<td align="right">0.3954097</td>
</tr>
</tbody>
</table>
<p>Where <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span> are the angles visible in <a href="Light.html#fig:Compdominated">fig.3</a> and kgdirect the proportion of the semi-hemisphere that receive direct light, considering sun position throughout the day by using stand latitude, day of year and row orientation. In the model, <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span> are computed in radian relative to the vertical plane above X. To provide a simpler representation, <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span> are also given in degrees relative to the horizontal plane (i.e. soil or dominated plant species surface) in tab.<a href="Light.html#tab:kdir">2.2</a>.</p>
</div>
<div id="incident-diffuse-radiation-from-the-atmosphere" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Incident diffuse radiation from the atmosphere</h3>
<p>The incident diffuse radiation for all angles between <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span> is computed using <code>G</code>, the apparent tangent to the considered <span class="math inline">\(\theta\)</span>. First the model computes it for <span class="math inline">\(\theta_1\)</span>, and uses it as a threshold under which no diffuse radiation comes from the atmosphere because only transmitted radiation reaches this angle for the considered X point. Second, the model tests if the X point is below the target crop canopy, and if not it computes <code>G</code> for <span class="math inline">\(\theta_2\)</span>, and applies the same methodology, with <code>G</code> being the upper threshold this time. This method avoids computing the left-hand quarter of the hemisphere since it receives only transmitted light necessarily if it is under the targeted crop.</p>
<p>Here is an example of the computation of the diffuse proportion received at each X point for the same crop as above (interrow= 1 meter, width= 0.2 meter, thickness= 0.1 meter, height= 1 meter) using the <code>kdif()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Initializations:</span>
htab=<span class="st"> </span><span class="kw">c</span>(<span class="fl">9.23</span>, <span class="fl">9.23</span>, <span class="fl">9.23</span>, <span class="fl">9.23</span>, <span class="fl">9.23</span>, <span class="fl">10.81</span>, <span class="fl">10.81</span>, <span class="fl">26.57</span>,
        <span class="fl">26.57</span>, <span class="fl">26.57</span>, <span class="fl">31.08</span>, <span class="fl">31.08</span>, <span class="fl">31.08</span>, <span class="fl">31.08</span>, <span class="fl">31.08</span>, <span class="fl">47.41</span>,
        <span class="fl">47.41</span>, <span class="fl">47.41</span>, <span class="fl">52.62</span>, <span class="fl">52.62</span>, <span class="fl">69.16</span>, <span class="fl">69.16</span>, <span class="fl">69.16</span>)
aztab=<span class="st"> </span><span class="kw">c</span>(<span class="fl">12.23</span>,<span class="fl">59.77</span>,<span class="fl">84.23</span>,<span class="fl">131.77</span>,<span class="fl">156.23</span>,<span class="dv">36</span>,<span class="dv">108</span>,<span class="dv">0</span>,<span class="dv">72</span>,<span class="dv">144</span>,<span class="fl">23.27</span>,<span class="fl">48.73</span>,<span class="fl">95.27</span>,
         <span class="fl">120.73</span>,<span class="fl">167.27</span>,<span class="dv">0</span>,<span class="dv">72</span>,<span class="dv">144</span>,<span class="dv">36</span>,<span class="dv">108</span>,<span class="dv">0</span>,<span class="dv">72</span>,<span class="dv">144</span>)
SOCtab=<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.0043</span>, <span class="fl">0.0043</span>, <span class="fl">0.0043</span>, <span class="fl">0.0043</span>, <span class="fl">0.0043</span>, <span class="fl">0.0055</span>,
          <span class="fl">0.0055</span>, <span class="fl">0.0140</span>, <span class="fl">0.0140</span>, <span class="fl">0.0140</span>, <span class="fl">0.0197</span>, <span class="fl">0.0197</span>,
          <span class="fl">0.0197</span>, <span class="fl">0.0197</span>, <span class="fl">0.0197</span>, <span class="fl">0.0336</span>, <span class="fl">0.0336</span>, <span class="fl">0.0336</span>,
          <span class="fl">0.0399</span>, <span class="fl">0.0399</span>, <span class="fl">0.0495</span>, <span class="fl">0.0495</span>, <span class="fl">0.0495</span>)
xprec=<span class="st"> </span><span class="dv">0</span>

<span class="cf">if</span>(ir<span class="op">&lt;</span><span class="fl">1.0</span>){interval =<span class="st"> </span><span class="dv">200</span>.}<span class="cf">else</span>{interval =<span class="st"> </span><span class="dv">20</span>.}
<span class="cf">if</span>(l<span class="op">&gt;</span>ir<span class="op">/</span><span class="dv">2</span>.){l =<span class="st"> </span>ir<span class="op">/</span><span class="dv">2</span>.}

<span class="co"># Saving some intermediate results for Output_diff here (not in the real function):</span>
x_s=<span class="st"> </span>(<span class="dv">1</span><span class="op">:</span>(ir <span class="op">/</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>interval))
Output_diff=<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x_index=</span> <span class="kw">rep</span>(x_s,<span class="dt">each=</span><span class="dv">23</span>),
                   <span class="dt">x_value=</span> <span class="kw">rep</span>((x_s<span class="op">-</span><span class="dv">1</span>)<span class="op">/</span>interval,<span class="dt">each=</span><span class="dv">23</span>),
                   <span class="dt">Angle =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">23</span>, <span class="kw">length</span>(x_s)),
                   <span class="dt">G1=</span> <span class="kw">rep</span>(<span class="ot">NA_real_</span>,<span class="kw">length</span>(x_s)<span class="op">*</span><span class="dv">23</span>),
                   <span class="dt">G2=</span> <span class="kw">rep</span>(<span class="ot">NA_real_</span>,<span class="kw">length</span>(x_s)<span class="op">*</span><span class="dv">23</span>),
                   <span class="dt">hcrit=</span> <span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(x_s)<span class="op">*</span><span class="dv">23</span>),
                   <span class="dt">kgdiffus=</span> <span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(x_s)<span class="op">*</span><span class="dv">23</span>))


<span class="co"># Loop over Xs:</span>

<span class="cf">for</span>(i <span class="cf">in</span> x_s){
  x =<span class="st"> </span>(i<span class="op">-</span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>interval
  <span class="cf">if</span>(xprec<span class="op">&lt;=</span>l<span class="op">/</span><span class="dv">2</span><span class="op">&amp;</span>x<span class="op">&gt;=</span>l<span class="op">/</span><span class="dv">2</span>){ilim =<span class="st"> </span>i}
  xprec =<span class="st"> </span>x
  
  <span class="co"># kdif:</span>
  
  x =<span class="st"> </span><span class="kw">min</span>(x,ir<span class="op">/</span><span class="dv">2</span>)
  e =<span class="st"> </span><span class="kw">abs</span>(l<span class="op">*</span>rap)
  kgdiffus =<span class="st"> </span><span class="dv">0</span>.
  
  <span class="co"># Computing for the right-hand of the row:</span>
  G1 =<span class="st"> </span>(haut<span class="op">+</span>e)<span class="op">/</span>(ir<span class="op">-</span>x<span class="op">-</span>l<span class="op">/</span><span class="dv">2</span>.) <span class="co"># the apparent tangent h1</span>
  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">23</span>){
    hcrit =<span class="st"> </span><span class="kw">atan</span>(G1<span class="op">*</span><span class="kw">sin</span>(aztab[j]<span class="op">/</span><span class="dv">180</span><span class="op">*</span>pi))<span class="op">/</span>pi<span class="op">*</span><span class="dv">180</span>
    <span class="cf">if</span>(hcrit<span class="op">&lt;</span>htab[j]){
      kgdiffus =<span class="st"> </span>kgdiffus<span class="op">+</span>SOCtab[j]
      ######## Not in the real function ########
      Output_diff<span class="op">$</span>kgdiffus[Output_diff<span class="op">$</span>x_index<span class="op">==</span>i<span class="op">&amp;</span>Output_diff<span class="op">$</span>Angle<span class="op">==</span>j]=<span class="st"> </span>SOCtab[j]
      ##########################################
    }
    ######## Not in the real function ########
    Output_diff<span class="op">$</span>hcrit[Output_diff<span class="op">$</span>x_index<span class="op">==</span>i<span class="op">&amp;</span>Output_diff<span class="op">$</span>Angle<span class="op">==</span>j]=<span class="st"> </span>hcrit
    Output_diff<span class="op">$</span>G1[Output_diff<span class="op">$</span>x_index<span class="op">==</span>i<span class="op">&amp;</span>Output_diff<span class="op">$</span>Angle<span class="op">==</span>j]=<span class="st"> </span>G1
    ##########################################
  }
  
  <span class="co"># Computing for the left-hand row, if the point is not a shaded point:</span>
  <span class="cf">if</span>(x<span class="op">&gt;</span>l<span class="op">/</span><span class="dv">2</span>){
    G2 =<span class="st"> </span>(haut<span class="op">+</span>e)<span class="op">/</span>(x<span class="op">-</span>l<span class="op">/</span><span class="dv">2</span>) <span class="co"># the apparent tangent h2</span>
    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">23</span>){
      hcrit =<span class="st"> </span><span class="kw">atan</span>(G2<span class="op">*</span><span class="kw">sin</span>(aztab[j]<span class="op">/</span><span class="dv">180</span><span class="op">*</span>pi))<span class="op">/</span>pi<span class="op">*</span><span class="dv">180</span>
      <span class="cf">if</span>(hcrit <span class="op">&lt;</span><span class="st"> </span>htab[j]){
        kgdiffus =<span class="st"> </span>kgdiffus<span class="op">+</span>SOCtab[j]
        ######## Not in the real function ########
        Output_diff<span class="op">$</span>kgdiffus[Output_diff<span class="op">$</span>x_index<span class="op">==</span>i<span class="op">&amp;</span>Output_diff<span class="op">$</span>Angle<span class="op">==</span>j]=<span class="st"> </span>
<span class="st">          </span>Output_diff<span class="op">$</span>kgdiffus[Output_diff<span class="op">$</span>x_index<span class="op">==</span>i<span class="op">&amp;</span>Output_diff<span class="op">$</span>Angle<span class="op">==</span>j]<span class="op">+</span>SOCtab[j]
        ##########################################
      }
      ######## Not in the real function ########
      Output_diff<span class="op">$</span>hcrit[Output_diff<span class="op">$</span>x_index<span class="op">==</span>i<span class="op">&amp;</span>Output_diff<span class="op">$</span>Angle<span class="op">==</span>j]=<span class="st"> </span>hcrit
      Output_diff<span class="op">$</span>G2[Output_diff<span class="op">$</span>x_index<span class="op">==</span>i<span class="op">&amp;</span>Output_diff<span class="op">$</span>Angle<span class="op">==</span>j]=<span class="st"> </span>G2
      ##########################################
    }
  }
}

<span class="kw">colnames</span>(Output_diff)=<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;X index&quot;</span>,<span class="st">&quot;X value (m)&quot;</span>,<span class="st">&quot;angle&quot;</span>,<span class="st">&quot;G1 (tangent)&quot;</span>,
                         <span class="st">&quot;G2 (tangent)&quot;</span>,<span class="st">&quot;hcrit&quot;</span>,<span class="st">&quot;kgdiffus&quot;</span>)
<span class="cf">if</span>(knitr<span class="op">:::</span><span class="kw">pandoc_to</span>() <span class="op">==</span><span class="st"> &quot;html&quot;</span>) {Output_diff}<span class="cf">else</span>{
  <span class="kw">kable</span>(Output_diff[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,],
        <span class="dt">caption =</span> <span class="kw">paste</span>(<span class="st">&quot;Computation of the diffuse light incident on each&quot;</span>,
                        <span class="st">&quot;point x. Ten first rows only, for the full data,&quot;</span>,
                        <span class="st">&quot;please refer to the html version of this book&quot;</span>),
        <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;X index&quot;</span>,<span class="st">&quot;X value (m)&quot;</span>,<span class="st">&quot;angle&quot;</span>,<span class="st">&quot;G1 (tangent)&quot;</span>,
                      <span class="st">&quot;G2 (tangent)&quot;</span>,<span class="st">&quot;hcrit&quot;</span>,<span class="st">&quot;kgdiffus&quot;</span>), <span class="dt">longtable =</span> <span class="ot">TRUE</span>)
}</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["X index"],"name":[1],"type":["int"],"align":["right"]},{"label":["X value (m)"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["angle"],"name":[3],"type":["int"],"align":["right"]},{"label":["G1 (tangent)"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["G2 (tangent)"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["hcrit"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["kgdiffus"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.00","3":"1","4":"1.222222","5":"NA","6":"14.51577","7":"0.0000"},{"1":"1","2":"0.00","3":"2","4":"1.222222","5":"NA","6":"46.56057","7":"0.0000"},{"1":"1","2":"0.00","3":"3","4":"1.222222","5":"NA","6":"50.56789","7":"0.0000"},{"1":"1","2":"0.00","3":"4","4":"1.222222","5":"NA","6":"42.35117","7":"0.0000"},{"1":"1","2":"0.00","3":"5","4":"1.222222","5":"NA","6":"26.22654","7":"0.0000"},{"1":"1","2":"0.00","3":"6","4":"1.222222","5":"NA","6":"35.69363","7":"0.0000"},{"1":"1","2":"0.00","3":"7","4":"1.222222","5":"NA","6":"49.29501","7":"0.0000"},{"1":"1","2":"0.00","3":"8","4":"1.222222","5":"NA","6":"0.00000","7":"0.0140"},{"1":"1","2":"0.00","3":"9","4":"1.222222","5":"NA","6":"49.29501","7":"0.0000"},{"1":"1","2":"0.00","3":"10","4":"1.222222","5":"NA","6":"35.69363","7":"0.0000"},{"1":"1","2":"0.00","3":"11","4":"1.222222","5":"NA","6":"25.77388","7":"0.0197"},{"1":"1","2":"0.00","3":"12","4":"1.222222","5":"NA","6":"42.57164","7":"0.0000"},{"1":"1","2":"0.00","3":"13","4":"1.222222","5":"NA","6":"50.59159","7":"0.0000"},{"1":"1","2":"0.00","3":"14","4":"1.222222","5":"NA","6":"46.41363","7":"0.0000"},{"1":"1","2":"0.00","3":"15","4":"1.222222","5":"NA","6":"15.07353","7":"0.0197"},{"1":"1","2":"0.00","3":"16","4":"1.222222","5":"NA","6":"0.00000","7":"0.0336"},{"1":"1","2":"0.00","3":"17","4":"1.222222","5":"NA","6":"49.29501","7":"0.0000"},{"1":"1","2":"0.00","3":"18","4":"1.222222","5":"NA","6":"35.69363","7":"0.0336"},{"1":"1","2":"0.00","3":"19","4":"1.222222","5":"NA","6":"35.69363","7":"0.0399"},{"1":"1","2":"0.00","3":"20","4":"1.222222","5":"NA","6":"49.29501","7":"0.0399"},{"1":"1","2":"0.00","3":"21","4":"1.222222","5":"NA","6":"0.00000","7":"0.0495"},{"1":"1","2":"0.00","3":"22","4":"1.222222","5":"NA","6":"49.29501","7":"0.0495"},{"1":"1","2":"0.00","3":"23","4":"1.222222","5":"NA","6":"35.69363","7":"0.0495"},{"1":"2","2":"0.05","3":"1","4":"1.294118","5":"NA","6":"15.33051","7":"0.0000"},{"1":"2","2":"0.05","3":"2","4":"1.294118","5":"NA","6":"48.19219","7":"0.0000"},{"1":"2","2":"0.05","3":"3","4":"1.294118","5":"NA","6":"52.16486","7":"0.0000"},{"1":"2","2":"0.05","3":"4","4":"1.294118","5":"NA","6":"43.98507","7":"0.0000"},{"1":"2","2":"0.05","3":"5","4":"1.294118","5":"NA","6":"27.54722","7":"0.0000"},{"1":"2","2":"0.05","3":"6","4":"1.294118","5":"NA","6":"37.25892","7":"0.0000"},{"1":"2","2":"0.05","3":"7","4":"1.294118","5":"NA","6":"50.90636","7":"0.0000"},{"1":"2","2":"0.05","3":"8","4":"1.294118","5":"NA","6":"0.00000","7":"0.0140"},{"1":"2","2":"0.05","3":"9","4":"1.294118","5":"NA","6":"50.90636","7":"0.0000"},{"1":"2","2":"0.05","3":"10","4":"1.294118","5":"NA","6":"37.25892","7":"0.0000"},{"1":"2","2":"0.05","3":"11","4":"1.294118","5":"NA","6":"27.07884","7":"0.0197"},{"1":"2","2":"0.05","3":"12","4":"1.294118","5":"NA","6":"44.20629","7":"0.0000"},{"1":"2","2":"0.05","3":"13","4":"1.294118","5":"NA","6":"52.18827","7":"0.0000"},{"1":"2","2":"0.05","3":"14","4":"1.294118","5":"NA","6":"48.04591","7":"0.0000"},{"1":"2","2":"0.05","3":"15","4":"1.294118","5":"NA","6":"15.91645","7":"0.0197"},{"1":"2","2":"0.05","3":"16","4":"1.294118","5":"NA","6":"0.00000","7":"0.0336"},{"1":"2","2":"0.05","3":"17","4":"1.294118","5":"NA","6":"50.90636","7":"0.0000"},{"1":"2","2":"0.05","3":"18","4":"1.294118","5":"NA","6":"37.25892","7":"0.0336"},{"1":"2","2":"0.05","3":"19","4":"1.294118","5":"NA","6":"37.25892","7":"0.0399"},{"1":"2","2":"0.05","3":"20","4":"1.294118","5":"NA","6":"50.90636","7":"0.0399"},{"1":"2","2":"0.05","3":"21","4":"1.294118","5":"NA","6":"0.00000","7":"0.0495"},{"1":"2","2":"0.05","3":"22","4":"1.294118","5":"NA","6":"50.90636","7":"0.0495"},{"1":"2","2":"0.05","3":"23","4":"1.294118","5":"NA","6":"37.25892","7":"0.0495"},{"1":"3","2":"0.10","3":"1","4":"1.375000","5":"NA","6":"16.23953","7":"0.0000"},{"1":"3","2":"0.10","3":"2","4":"1.375000","5":"NA","6":"49.91135","7":"0.0000"},{"1":"3","2":"0.10","3":"3","4":"1.375000","5":"NA","6":"53.83408","7":"0.0000"},{"1":"3","2":"0.10","3":"4","4":"1.375000","5":"NA","6":"45.72154","7":"0.0000"},{"1":"3","2":"0.10","3":"5","4":"1.375000","5":"NA","6":"28.99592","7":"0.0000"},{"1":"3","2":"0.10","3":"6","4":"1.375000","5":"NA","6":"38.94531","7":"0.0000"},{"1":"3","2":"0.10","3":"7","4":"1.375000","5":"NA","6":"52.59486","7":"0.0000"},{"1":"3","2":"0.10","3":"8","4":"1.375000","5":"NA","6":"0.00000","7":"0.0140"},{"1":"3","2":"0.10","3":"9","4":"1.375000","5":"NA","6":"52.59486","7":"0.0000"},{"1":"3","2":"0.10","3":"10","4":"1.375000","5":"NA","6":"38.94531","7":"0.0000"},{"1":"3","2":"0.10","3":"11","4":"1.375000","5":"NA","6":"28.51142","7":"0.0197"},{"1":"3","2":"0.10","3":"12","4":"1.375000","5":"NA","6":"45.94279","7":"0.0000"},{"1":"3","2":"0.10","3":"13","4":"1.375000","5":"NA","6":"53.85710","7":"0.0000"},{"1":"3","2":"0.10","3":"14","4":"1.375000","5":"NA","6":"49.76629","7":"0.0000"},{"1":"3","2":"0.10","3":"15","4":"1.375000","5":"NA","6":"16.85633","7":"0.0197"},{"1":"3","2":"0.10","3":"16","4":"1.375000","5":"NA","6":"0.00000","7":"0.0336"},{"1":"3","2":"0.10","3":"17","4":"1.375000","5":"NA","6":"52.59486","7":"0.0000"},{"1":"3","2":"0.10","3":"18","4":"1.375000","5":"NA","6":"38.94531","7":"0.0336"},{"1":"3","2":"0.10","3":"19","4":"1.375000","5":"NA","6":"38.94531","7":"0.0399"},{"1":"3","2":"0.10","3":"20","4":"1.375000","5":"NA","6":"52.59486","7":"0.0399"},{"1":"3","2":"0.10","3":"21","4":"1.375000","5":"NA","6":"0.00000","7":"0.0495"},{"1":"3","2":"0.10","3":"22","4":"1.375000","5":"NA","6":"52.59486","7":"0.0495"},{"1":"3","2":"0.10","3":"23","4":"1.375000","5":"NA","6":"38.94531","7":"0.0495"},{"1":"4","2":"0.15","3":"1","4":"1.466667","5":"22.000000","6":"77.88947","7":"0.0000"},{"1":"4","2":"0.15","3":"2","4":"1.466667","5":"22.000000","6":"86.98852","7":"0.0000"},{"1":"4","2":"0.15","3":"3","4":"1.466667","5":"22.000000","6":"87.38420","7":"0.0000"},{"1":"4","2":"0.15","3":"4","4":"1.466667","5":"22.000000","6":"86.51240","7":"0.0000"},{"1":"4","2":"0.15","3":"5","4":"1.466667","5":"22.000000","6":"83.56583","7":"0.0000"},{"1":"4","2":"0.15","3":"6","4":"1.466667","5":"22.000000","6":"85.57801","7":"0.0000"},{"1":"4","2":"0.15","3":"7","4":"1.466667","5":"22.000000","6":"87.26370","7":"0.0000"},{"1":"4","2":"0.15","3":"8","4":"1.466667","5":"22.000000","6":"0.00000","7":"0.0280"},{"1":"4","2":"0.15","3":"9","4":"1.466667","5":"22.000000","6":"87.26370","7":"0.0000"},{"1":"4","2":"0.15","3":"10","4":"1.466667","5":"22.000000","6":"85.57801","7":"0.0000"},{"1":"4","2":"0.15","3":"11","4":"1.466667","5":"22.000000","6":"83.43664","7":"0.0197"},{"1":"4","2":"0.15","3":"12","4":"1.466667","5":"22.000000","6":"86.53918","7":"0.0000"},{"1":"4","2":"0.15","3":"13","4":"1.466667","5":"22.000000","6":"87.38641","7":"0.0000"},{"1":"4","2":"0.15","3":"14","4":"1.466667","5":"22.000000","6":"86.97304","7":"0.0000"},{"1":"4","2":"0.15","3":"15","4":"1.466667","5":"22.000000","6":"78.34468","7":"0.0197"},{"1":"4","2":"0.15","3":"16","4":"1.466667","5":"22.000000","6":"0.00000","7":"0.0672"},{"1":"4","2":"0.15","3":"17","4":"1.466667","5":"22.000000","6":"87.26370","7":"0.0000"},{"1":"4","2":"0.15","3":"18","4":"1.466667","5":"22.000000","6":"85.57801","7":"0.0336"},{"1":"4","2":"0.15","3":"19","4":"1.466667","5":"22.000000","6":"85.57801","7":"0.0399"},{"1":"4","2":"0.15","3":"20","4":"1.466667","5":"22.000000","6":"87.26370","7":"0.0000"},{"1":"4","2":"0.15","3":"21","4":"1.466667","5":"22.000000","6":"0.00000","7":"0.0990"},{"1":"4","2":"0.15","3":"22","4":"1.466667","5":"22.000000","6":"87.26370","7":"0.0495"},{"1":"4","2":"0.15","3":"23","4":"1.466667","5":"22.000000","6":"85.57801","7":"0.0495"},{"1":"5","2":"0.20","3":"1","4":"1.571429","5":"11.000000","6":"66.77354","7":"0.0000"},{"1":"5","2":"0.20","3":"2","4":"1.571429","5":"11.000000","6":"83.99358","7":"0.0000"},{"1":"5","2":"0.20","3":"3","4":"1.571429","5":"11.000000","6":"84.77927","7":"0.0000"},{"1":"5","2":"0.20","3":"4","4":"1.571429","5":"11.000000","6":"83.05046","7":"0.0000"},{"1":"5","2":"0.20","3":"5","4":"1.571429","5":"11.000000","6":"77.28996","7":"0.0000"},{"1":"5","2":"0.20","3":"6","4":"1.571429","5":"11.000000","6":"81.20808","7":"0.0000"},{"1":"5","2":"0.20","3":"7","4":"1.571429","5":"11.000000","6":"84.53983","7":"0.0000"},{"1":"5","2":"0.20","3":"8","4":"1.571429","5":"11.000000","6":"0.00000","7":"0.0280"},{"1":"5","2":"0.20","3":"9","4":"1.571429","5":"11.000000","6":"84.53983","7":"0.0000"},{"1":"5","2":"0.20","3":"10","4":"1.571429","5":"11.000000","6":"81.20808","7":"0.0000"},{"1":"5","2":"0.20","3":"11","4":"1.571429","5":"11.000000","6":"77.04114","7":"0.0000"},{"1":"5","2":"0.20","3":"12","4":"1.571429","5":"11.000000","6":"83.10343","7":"0.0000"},{"1":"5","2":"0.20","3":"13","4":"1.571429","5":"11.000000","6":"84.78364","7":"0.0000"},{"1":"5","2":"0.20","3":"14","4":"1.571429","5":"11.000000","6":"83.96288","7":"0.0000"},{"1":"5","2":"0.20","3":"15","4":"1.571429","5":"11.000000","6":"67.58122","7":"0.0197"},{"1":"5","2":"0.20","3":"16","4":"1.571429","5":"11.000000","6":"0.00000","7":"0.0672"},{"1":"5","2":"0.20","3":"17","4":"1.571429","5":"11.000000","6":"84.53983","7":"0.0000"},{"1":"5","2":"0.20","3":"18","4":"1.571429","5":"11.000000","6":"81.20808","7":"0.0336"},{"1":"5","2":"0.20","3":"19","4":"1.571429","5":"11.000000","6":"81.20808","7":"0.0399"},{"1":"5","2":"0.20","3":"20","4":"1.571429","5":"11.000000","6":"84.53983","7":"0.0000"},{"1":"5","2":"0.20","3":"21","4":"1.571429","5":"11.000000","6":"0.00000","7":"0.0990"},{"1":"5","2":"0.20","3":"22","4":"1.571429","5":"11.000000","6":"84.53983","7":"0.0495"},{"1":"5","2":"0.20","3":"23","4":"1.571429","5":"11.000000","6":"81.20808","7":"0.0495"},{"1":"6","2":"0.25","3":"1","4":"1.692308","5":"7.333333","6":"57.22976","7":"0.0000"},{"1":"6","2":"0.25","3":"2","4":"1.692308","5":"7.333333","6":"81.03120","7":"0.0000"},{"1":"6","2":"0.25","3":"3","4":"1.692308","5":"7.333333","6":"82.19578","7":"0.0000"},{"1":"6","2":"0.25","3":"4","4":"1.692308","5":"7.333333","6":"79.63871","7":"0.0000"},{"1":"6","2":"0.25","3":"5","4":"1.692308","5":"7.333333","6":"71.30851","7":"0.0000"},{"1":"6","2":"0.25","3":"6","4":"1.692308","5":"7.333333","6":"76.93868","7":"0.0000"},{"1":"6","2":"0.25","3":"7","4":"1.692308","5":"7.333333","6":"81.84047","7":"0.0000"},{"1":"6","2":"0.25","3":"8","4":"1.692308","5":"7.333333","6":"0.00000","7":"0.0280"},{"1":"6","2":"0.25","3":"9","4":"1.692308","5":"7.333333","6":"81.84047","7":"0.0000"},{"1":"6","2":"0.25","3":"10","4":"1.692308","5":"7.333333","6":"76.93868","7":"0.0000"},{"1":"6","2":"0.25","3":"11","4":"1.692308","5":"7.333333","6":"70.95696","7":"0.0000"},{"1":"6","2":"0.25","3":"12","4":"1.692308","5":"7.333333","6":"79.71675","7":"0.0000"},{"1":"6","2":"0.25","3":"13","4":"1.692308","5":"7.333333","6":"82.20228","7":"0.0000"},{"1":"6","2":"0.25","3":"14","4":"1.692308","5":"7.333333","6":"80.98578","7":"0.0000"},{"1":"6","2":"0.25","3":"15","4":"1.692308","5":"7.333333","6":"58.24951","7":"0.0197"},{"1":"6","2":"0.25","3":"16","4":"1.692308","5":"7.333333","6":"0.00000","7":"0.0672"},{"1":"6","2":"0.25","3":"17","4":"1.692308","5":"7.333333","6":"81.84047","7":"0.0000"},{"1":"6","2":"0.25","3":"18","4":"1.692308","5":"7.333333","6":"76.93868","7":"0.0336"},{"1":"6","2":"0.25","3":"19","4":"1.692308","5":"7.333333","6":"76.93868","7":"0.0399"},{"1":"6","2":"0.25","3":"20","4":"1.692308","5":"7.333333","6":"81.84047","7":"0.0000"},{"1":"6","2":"0.25","3":"21","4":"1.692308","5":"7.333333","6":"0.00000","7":"0.0990"},{"1":"6","2":"0.25","3":"22","4":"1.692308","5":"7.333333","6":"81.84047","7":"0.0495"},{"1":"6","2":"0.25","3":"23","4":"1.692308","5":"7.333333","6":"76.93868","7":"0.0495"},{"1":"7","2":"0.30","3":"1","4":"1.833333","5":"5.500000","6":"49.36068","7":"0.0000"},{"1":"7","2":"0.30","3":"2","4":"1.833333","5":"5.500000","6":"78.11635","7":"0.0000"},{"1":"7","2":"0.30","3":"3","4":"1.833333","5":"5.500000","6":"79.64381","7":"0.0000"},{"1":"7","2":"0.30","3":"4","4":"1.833333","5":"5.500000","6":"76.29959","7":"0.0000"},{"1":"7","2":"0.30","3":"5","4":"1.833333","5":"5.500000","6":"65.72045","7":"0.0000"},{"1":"7","2":"0.30","3":"6","4":"1.833333","5":"5.500000","6":"72.81172","7":"0.0000"},{"1":"7","2":"0.30","3":"7","4":"1.833333","5":"5.500000","6":"79.17707","7":"0.0000"},{"1":"7","2":"0.30","3":"8","4":"1.833333","5":"5.500000","6":"0.00000","7":"0.0280"},{"1":"7","2":"0.30","3":"9","4":"1.833333","5":"5.500000","6":"79.17707","7":"0.0000"},{"1":"7","2":"0.30","3":"10","4":"1.833333","5":"5.500000","6":"72.81172","7":"0.0000"},{"1":"7","2":"0.30","3":"11","4":"1.833333","5":"5.500000","6":"65.28698","7":"0.0000"},{"1":"7","2":"0.30","3":"12","4":"1.833333","5":"5.500000","6":"76.40110","7":"0.0000"},{"1":"7","2":"0.30","3":"13","4":"1.833333","5":"5.500000","6":"79.65235","7":"0.0000"},{"1":"7","2":"0.30","3":"14","4":"1.833333","5":"5.500000","6":"78.05691","7":"0.0000"},{"1":"7","2":"0.30","3":"15","4":"1.833333","5":"5.500000","6":"50.47370","7":"0.0197"},{"1":"7","2":"0.30","3":"16","4":"1.833333","5":"5.500000","6":"0.00000","7":"0.0672"},{"1":"7","2":"0.30","3":"17","4":"1.833333","5":"5.500000","6":"79.17707","7":"0.0000"},{"1":"7","2":"0.30","3":"18","4":"1.833333","5":"5.500000","6":"72.81172","7":"0.0336"},{"1":"7","2":"0.30","3":"19","4":"1.833333","5":"5.500000","6":"72.81172","7":"0.0399"},{"1":"7","2":"0.30","3":"20","4":"1.833333","5":"5.500000","6":"79.17707","7":"0.0000"},{"1":"7","2":"0.30","3":"21","4":"1.833333","5":"5.500000","6":"0.00000","7":"0.0990"},{"1":"7","2":"0.30","3":"22","4":"1.833333","5":"5.500000","6":"79.17707","7":"0.0495"},{"1":"7","2":"0.30","3":"23","4":"1.833333","5":"5.500000","6":"72.81172","7":"0.0495"},{"1":"8","2":"0.35","3":"1","4":"2.000000","5":"4.400000","6":"42.98669","7":"0.0000"},{"1":"8","2":"0.35","3":"2","4":"2.000000","5":"4.400000","6":"75.26256","7":"0.0000"},{"1":"8","2":"0.35","3":"3","4":"2.000000","5":"4.400000","6":"77.13270","7":"0.0000"},{"1":"8","2":"0.35","3":"4","4":"2.000000","5":"4.400000","6":"73.05262","7":"0.0000"},{"1":"8","2":"0.35","3":"5","4":"2.000000","5":"4.400000","6":"60.58311","7":"0.0000"},{"1":"8","2":"0.35","3":"6","4":"2.000000","5":"4.400000","6":"68.86053","7":"0.0000"},{"1":"8","2":"0.35","3":"7","4":"2.000000","5":"4.400000","6":"76.56015","7":"0.0000"},{"1":"8","2":"0.35","3":"8","4":"2.000000","5":"4.400000","6":"0.00000","7":"0.0280"},{"1":"8","2":"0.35","3":"9","4":"2.000000","5":"4.400000","6":"76.56015","7":"0.0000"},{"1":"8","2":"0.35","3":"10","4":"2.000000","5":"4.400000","6":"68.86053","7":"0.0000"},{"1":"8","2":"0.35","3":"11","4":"2.000000","5":"4.400000","6":"60.08904","7":"0.0000"},{"1":"8","2":"0.35","3":"12","4":"2.000000","5":"4.400000","6":"73.17566","7":"0.0000"},{"1":"8","2":"0.35","3":"13","4":"2.000000","5":"4.400000","6":"77.14318","7":"0.0000"},{"1":"8","2":"0.35","3":"14","4":"2.000000","5":"4.400000","6":"75.18999","7":"0.0000"},{"1":"8","2":"0.35","3":"15","4":"2.000000","5":"4.400000","6":"44.11487","7":"0.0197"},{"1":"8","2":"0.35","3":"16","4":"2.000000","5":"4.400000","6":"0.00000","7":"0.0672"},{"1":"8","2":"0.35","3":"17","4":"2.000000","5":"4.400000","6":"76.56015","7":"0.0000"},{"1":"8","2":"0.35","3":"18","4":"2.000000","5":"4.400000","6":"68.86053","7":"0.0000"},{"1":"8","2":"0.35","3":"19","4":"2.000000","5":"4.400000","6":"68.86053","7":"0.0399"},{"1":"8","2":"0.35","3":"20","4":"2.000000","5":"4.400000","6":"76.56015","7":"0.0000"},{"1":"8","2":"0.35","3":"21","4":"2.000000","5":"4.400000","6":"0.00000","7":"0.0990"},{"1":"8","2":"0.35","3":"22","4":"2.000000","5":"4.400000","6":"76.56015","7":"0.0495"},{"1":"8","2":"0.35","3":"23","4":"2.000000","5":"4.400000","6":"68.86053","7":"0.0990"},{"1":"9","2":"0.40","3":"1","4":"2.200000","5":"3.666667","6":"37.83770","7":"0.0000"},{"1":"9","2":"0.40","3":"2","4":"2.200000","5":"3.666667","6":"72.48157","7":"0.0000"},{"1":"9","2":"0.40","3":"3","4":"2.200000","5":"3.666667","6":"74.67084","7":"0.0000"},{"1":"9","2":"0.40","3":"4","4":"2.200000","5":"3.666667","6":"69.91395","7":"0.0000"},{"1":"9","2":"0.40","3":"5","4":"2.200000","5":"3.666667","6":"55.91648","7":"0.0000"},{"1":"9","2":"0.40","3":"6","4":"2.200000","5":"3.666667","6":"65.10911","7":"0.0000"},{"1":"9","2":"0.40","3":"7","4":"2.200000","5":"3.666667","6":"73.99910","7":"0.0000"},{"1":"9","2":"0.40","3":"8","4":"2.200000","5":"3.666667","6":"0.00000","7":"0.0280"},{"1":"9","2":"0.40","3":"9","4":"2.200000","5":"3.666667","6":"73.99910","7":"0.0000"},{"1":"9","2":"0.40","3":"10","4":"2.200000","5":"3.666667","6":"65.10911","7":"0.0000"},{"1":"9","2":"0.40","3":"11","4":"2.200000","5":"3.666667","6":"55.38129","7":"0.0000"},{"1":"9","2":"0.40","3":"12","4":"2.200000","5":"3.666667","6":"70.05631","7":"0.0000"},{"1":"9","2":"0.40","3":"13","4":"2.200000","5":"3.666667","6":"74.68316","7":"0.0000"},{"1":"9","2":"0.40","3":"14","4":"2.200000","5":"3.666667","6":"72.39692","7":"0.0000"},{"1":"9","2":"0.40","3":"15","4":"2.200000","5":"3.666667","6":"38.93736","7":"0.0197"},{"1":"9","2":"0.40","3":"16","4":"2.200000","5":"3.666667","6":"0.00000","7":"0.0672"},{"1":"9","2":"0.40","3":"17","4":"2.200000","5":"3.666667","6":"73.99910","7":"0.0000"},{"1":"9","2":"0.40","3":"18","4":"2.200000","5":"3.666667","6":"65.10911","7":"0.0000"},{"1":"9","2":"0.40","3":"19","4":"2.200000","5":"3.666667","6":"65.10911","7":"0.0399"},{"1":"9","2":"0.40","3":"20","4":"2.200000","5":"3.666667","6":"73.99910","7":"0.0000"},{"1":"9","2":"0.40","3":"21","4":"2.200000","5":"3.666667","6":"0.00000","7":"0.0990"},{"1":"9","2":"0.40","3":"22","4":"2.200000","5":"3.666667","6":"73.99910","7":"0.0495"},{"1":"9","2":"0.40","3":"23","4":"2.200000","5":"3.666667","6":"65.10911","7":"0.0990"},{"1":"10","2":"0.45","3":"1","4":"2.444444","5":"3.142857","6":"33.65456","7":"0.0000"},{"1":"10","2":"0.45","3":"2","4":"2.444444","5":"3.142857","6":"69.78321","7":"0.0000"},{"1":"10","2":"0.45","3":"3","4":"2.444444","5":"3.142857","6":"72.26561","7":"0.0000"},{"1":"10","2":"0.45","3":"4","4":"2.444444","5":"3.142857","6":"66.89607","7":"0.0000"},{"1":"10","2":"0.45","3":"5","4":"2.444444","5":"3.142857","6":"51.71232","7":"0.0000"},{"1":"10","2":"0.45","3":"6","4":"2.444444","5":"3.142857","6":"61.57229","7":"0.0000"},{"1":"10","2":"0.45","3":"7","4":"2.444444","5":"3.142857","6":"71.50202","7":"0.0000"},{"1":"10","2":"0.45","3":"8","4":"2.444444","5":"3.142857","6":"0.00000","7":"0.0280"},{"1":"10","2":"0.45","3":"9","4":"2.444444","5":"3.142857","6":"71.50202","7":"0.0000"},{"1":"10","2":"0.45","3":"10","4":"2.444444","5":"3.142857","6":"61.57229","7":"0.0000"},{"1":"10","2":"0.45","3":"11","4":"2.444444","5":"3.142857","6":"51.15231","7":"0.0000"},{"1":"10","2":"0.45","3":"12","4":"2.444444","5":"3.142857","6":"67.05541","7":"0.0000"},{"1":"10","2":"0.45","3":"13","4":"2.444444","5":"3.142857","6":"72.27963","7":"0.0000"},{"1":"10","2":"0.45","3":"14","4":"2.444444","5":"3.142857","6":"69.68759","7":"0.0000"},{"1":"10","2":"0.45","3":"15","4":"2.444444","5":"3.142857","6":"34.70456","7":"0.0197"},{"1":"10","2":"0.45","3":"16","4":"2.444444","5":"3.142857","6":"0.00000","7":"0.0672"},{"1":"10","2":"0.45","3":"17","4":"2.444444","5":"3.142857","6":"71.50202","7":"0.0000"},{"1":"10","2":"0.45","3":"18","4":"2.444444","5":"3.142857","6":"61.57229","7":"0.0000"},{"1":"10","2":"0.45","3":"19","4":"2.444444","5":"3.142857","6":"61.57229","7":"0.0000"},{"1":"10","2":"0.45","3":"20","4":"2.444444","5":"3.142857","6":"71.50202","7":"0.0000"},{"1":"10","2":"0.45","3":"21","4":"2.444444","5":"3.142857","6":"0.00000","7":"0.0990"},{"1":"10","2":"0.45","3":"22","4":"2.444444","5":"3.142857","6":"71.50202","7":"0.0495"},{"1":"10","2":"0.45","3":"23","4":"2.444444","5":"3.142857","6":"61.57229","7":"0.0990"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The total diffuse radiation incident to each point X is simply the cumulative of each angle:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressWarnings</span>(<span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(dplyr)))
Output_diff<span class="op">%&lt;&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">X index</span><span class="st">`</span>)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">kgdiffus=</span> <span class="kw">sum</span>(kgdiffus))

<span class="kw">kable</span>(Output_diff,<span class="dt">caption=</span> <span class="kw">paste</span>(<span class="st">&quot;Example of the computation of the incident diffuse&quot;</span>,
<span class="st">&quot;radiation ratio kgdiffus. See introduction section for further details on the crop.&quot;</span>))</code></pre></div>
<table>
<caption><span id="tab:kdifftot">Table 2.3: </span>Example of the computation of the incident diffuse radiation ratio kgdiffus. See introduction section for further details on the crop.</caption>
<thead>
<tr class="header">
<th align="right">X index</th>
<th align="right">kgdiffus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.3489</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.3489</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.3489</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.4061</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.3864</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.3864</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">0.3864</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.4023</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">0.4023</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">0.3624</td>
</tr>
</tbody>
</table>
</div>
<div id="total-diffuse-and-direct-radiation-from-the-atmosphere-incident-to-each-x-point" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Total diffuse and direct radiation from the atmosphere incident to each X point</h3>
<p>The total radiation from the atmosphere incident to each X point is computed by using the incident diffuse (<code>rdif</code>) and direct (<code>rdirect</code>) radiation coming from the atmosphere weighted respectively by the previously computed <code>kgdiffus</code> and <code>kgdirect</code> as follow: <span class="math inline">\(rdroit=(kgdiffus\cdot rdif)+(kgdirect\cdot rdirect)\)</span></p>
</div>
<div id="light-tramsitted-by-the-dominant-crop-to-the-x-points" class="section level3">
<h3><span class="header-section-number">2.3.4</span> Light tramsitted by the dominant crop to the X points</h3>
<p>The light transmitted by the dominant crop to the dominated crop (<code>rtransmis</code>) is computed using the total radiation from the atmosphere incident to each X point (<code>rdroit</code>) and the effective targeted plant leaf area index as follow:</p>
<p><span class="math inline">\(rtransmis=(1.0-rdroit)\cdot e^{-P_{ktrou}\cdot(lai+eai)}\)</span></p>
<p>where <span class="math inline">\(P_{ktrou}\)</span> is the targeted plant light extinction coefficient, <code>lai</code> the plant leaf area index, and <code>eai</code> the equivalent leaf area index, which represent the photosynthetic surface that is not from leaves (e.g. wheat ears, rapeseed pods, pea pods or grapes during their green stage).</p>
</div>
<div id="total-light-incident-to-x-points" class="section level3">
<h3><span class="header-section-number">2.3.5</span> Total light incident to X points</h3>
<p>The total light incident to each X point is the sum of the three components: atmospheric diffuse light, atmospheric direct light and transmitted light by the dominant crop. Taking our previous example again, this computation leads to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rdirect=<span class="st"> </span><span class="dv">1</span><span class="op">-</span>rdif
rdroit=<span class="st"> </span>(Output_diff<span class="op">$</span>kgdiffus<span class="op">*</span>rdif)<span class="op">+</span>(Output<span class="op">$</span>kg<span class="op">*</span>rdirect)
rtransmis =<span class="st"> </span>(<span class="fl">1.0</span> <span class="op">-</span><span class="st"> </span>rdroit) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(<span class="op">-</span>P_ktrou <span class="op">*</span><span class="st"> </span>(lai <span class="op">+</span><span class="st"> </span>eai)))

incident_light=<span class="st"> </span>
<span class="st">  </span><span class="kw">data.frame</span>(Output[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>],<span class="dt">Total=</span>rdroit<span class="op">+</span>rtransmis, <span class="dt">rdroit=</span> rdroit,
             <span class="dt">rtransmis=</span> rtransmis, 
             <span class="dt">light_env=</span> <span class="kw">ifelse</span>(Output<span class="op">$</span><span class="st">`</span><span class="dt">X value (m)</span><span class="st">`</span><span class="op">&lt;</span>limite,<span class="st">&quot;Shaded&quot;</span>,<span class="st">&quot;Sunlit&quot;</span>))
<span class="kw">kable</span>(incident_light,
      <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;X index&quot;</span>,<span class="st">&quot;X value (m)&quot;</span>,<span class="st">&quot;Total incident ratio&quot;</span>,
                    <span class="st">&quot;Atmospheric ratio (rdroit)&quot;</span>,<span class="st">&quot;Transmitted ratio (rtransmis)&quot;</span>,
                    <span class="st">&quot;Light environment&quot;</span>),
  <span class="dt">caption=</span><span class="kw">paste</span>(<span class="st">&quot;Example of the computation of the total incident radiation ratio.&quot;</span>,
                <span class="st">&quot;See introduction section for further details on the crop.&quot;</span>))</code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-5">Table 2.4: </span>Example of the computation of the total incident radiation ratio. See introduction section for further details on the crop.</caption>
<thead>
<tr class="header">
<th align="right">X index</th>
<th align="right">X value (m)</th>
<th align="right">Total incident ratio</th>
<th align="right">Atmospheric ratio (rdroit)</th>
<th align="right">Transmitted ratio (rtransmis)</th>
<th align="left">Light environment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.00</td>
<td align="right">0.7727202</td>
<td align="right">0.3106046</td>
<td align="right">0.4621155</td>
<td align="left">Shaded</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.05</td>
<td align="right">0.7784515</td>
<td align="right">0.3279890</td>
<td align="right">0.4504624</td>
<td align="left">Shaded</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.10</td>
<td align="right">0.7799044</td>
<td align="right">0.3323963</td>
<td align="right">0.4475082</td>
<td align="left">Sunlit</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.15</td>
<td align="right">0.7931983</td>
<td align="right">0.3727197</td>
<td align="right">0.4204785</td>
<td align="left">Sunlit</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.20</td>
<td align="right">0.7918188</td>
<td align="right">0.3685355</td>
<td align="right">0.4232833</td>
<td align="left">Sunlit</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.25</td>
<td align="right">0.7975112</td>
<td align="right">0.3858020</td>
<td align="right">0.4117092</td>
<td align="left">Sunlit</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">0.30</td>
<td align="right">0.7984328</td>
<td align="right">0.3885975</td>
<td align="right">0.4098354</td>
<td align="left">Sunlit</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.35</td>
<td align="right">0.8011901</td>
<td align="right">0.3969610</td>
<td align="right">0.4042292</td>
<td align="left">Sunlit</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">0.40</td>
<td align="right">0.7961262</td>
<td align="right">0.3816007</td>
<td align="right">0.4145254</td>
<td align="left">Sunlit</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">0.45</td>
<td align="right">0.7963256</td>
<td align="right">0.3822058</td>
<td align="right">0.4141198</td>
<td align="left">Sunlit</td>
</tr>
</tbody>
</table>
<p>The Total incident ratio is computed as: <code>Total incident ratio= rdroit+rtransmis</code>. It is the proportion of the incident ligth from the atmosphere that reach the point on the plane below the plant canopy. This light either comes directly from the sky (<code>rdroit</code>) or passing through the plant canopy (<code>rtransmis</code>). Consequently, the first point <code>X</code> of our example that is right under the plant canopy receives in average 77.2720162% of the light coming from the atmosphere: 31.0604617% of the light directly from the sky (either direct or diffuse light) + 46.2115545% of the light that is transmitted by the plant above.</p>
</div>
<div id="total-radiation-incident-to-the-plane" class="section level3">
<h3><span class="header-section-number">2.3.6</span> Total radiation incident to the plane</h3>
<p>After computing the total incident ratio for each point, the model averages the values between the so-called sunlit and shaded components. Each point positioned right under the plant canopy is considered shaded, and all other is considered sunlit (see fig. <a href="Light.html#fig:Compdominated">2.3</a>). using our previous example, this computation gives:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">incident_light<span class="op">%&lt;&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(light_env)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Total=</span> <span class="kw">mean</span>(Total))<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">Variable=</span> <span class="kw">c</span>(<span class="st">&quot;rombre&quot;</span>,<span class="st">&quot;rsoleil&quot;</span>),light_env,Total)

<span class="kw">kable</span>(incident_light, 
      <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;STICS variable name&quot;</span>,<span class="st">&quot;Light environment&quot;</span>,
                    <span class="st">&quot;Total incident light ratio&quot;</span>),
      <span class="dt">caption=</span> <span class="kw">paste</span>(<span class="st">&quot;Example of the computation of the total incident radiation&quot;</span>,
                     <span class="st">&quot;ratio for each light environment for a horizontal plane below&quot;</span>,
                     <span class="st">&quot;the targeted plant canopy. See introduction section for further&quot;</span>,
                     <span class="st">&quot;details on the crop.&quot;</span>))</code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-6">Table 2.5: </span>Example of the computation of the total incident radiation ratio for each light environment for a horizontal plane below the targeted plant canopy. See introduction section for further details on the crop.</caption>
<thead>
<tr class="header">
<th align="left">STICS variable name</th>
<th align="left">Light environment</th>
<th align="right">Total incident light ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">rombre</td>
<td align="left">Shaded</td>
<td align="right">0.7755858</td>
</tr>
<tr class="even">
<td align="left">rsoleil</td>
<td align="left">Sunlit</td>
<td align="right">0.7943134</td>
</tr>
</tbody>
</table>
<p>Finally, both ratios are used to compute the intercepted PAR <code>raint</code> (MJ m-2 d-1) of the target plant as:<br />
<span class="math inline">\(raint=P_{parsurrg}\cdot trg\cdot(1-(rombre\cdot surfAO)-(rsoleil\cdot surfAS))\)</span><br />
where <span class="math inline">\(P_{parsurrg}\)</span> is a coefficient to compute PAR (Photosynthetically Active Radiation) from the global radiation, <code>trg</code> is the active radiation (either global radiation or radiation transmitted below the dominant crop), <code>rombre</code> and <code>rsoleil</code> are the ratio of incident light for shaded and sunlit components of the plane, and <code>surfAO</code> and <code>surfAS</code> are the relative surfaces (0 to 1) of the shaded and sunlit components of the plane. The computation of <code>trg</code> is further described in Chapter <a href="trg.html#trg">3</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(magrittr)
P_parsurrg=<span class="st"> </span><span class="fl">0.5</span>
incident_light<span class="op">%&lt;&gt;%</span><span class="kw">spread</span>(light_env,Total)
surfAO =<span class="st"> </span>l<span class="op">/</span>ir
surfAO =<span class="st"> </span><span class="kw">min</span>(surfAO,<span class="fl">1.0</span>)
surfAS =<span class="st"> </span><span class="fl">1.0</span> <span class="op">-</span><span class="st"> </span>surfAO
raint =<span class="st"> </span>P_parsurrg <span class="op">*</span><span class="st"> </span>trg <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(incident_light<span class="op">$</span>Shaded[<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>surfAO) <span class="op">-</span><span class="st"> </span>
<span class="st">                              </span>(incident_light<span class="op">$</span>Sunlit[<span class="dv">2</span>]<span class="op">*</span><span class="st"> </span>surfAS))</code></pre></div>
<p>For our example, the crop would have intercepted 2.62 MJ m-2 day-1 of radiation, with a PAR of 12.5 W m-2, an <code>rombre</code> of 0.7755858, an <code>rsoleil</code> of 0.7943134 and a relative surface of 0.2 and 0.8 for the shaded and sunlit component respectively.</p>
<blockquote>
<p>The relative surfaces (0 to 1) of the shaded and sunlit components of the plane (<code>surfAO</code> and <code>surfAS</code>) that are computed during the dominant plant computation are then used as the shaded and sunlit surfaces for the dominated plant.</p>
</blockquote>
</div>
</div>
<div id="summary" class="section level2">
<h2><span class="header-section-number">2.4</span> Summary</h2>
<p>The interception of the targeted plant is obtained by:</p>
<ol style="list-style-type: decimal">
<li>Computing the light that is incident at a horizontal plane at the height of the dominated plant (or the soil) and,</li>
<li>Substracting this incident light to the global PAR, which gives the PAR intercepted by the target plant.</li>
</ol>
<p>This process is applied iteratively to the dominant and the dominated plant to compute both species PAR interception while taking account for their respective structure (shape, height, width…).</p>
</div>
<div id="discussion-and-proposed-modifications" class="section level2">
<h2><span class="header-section-number">2.5</span> Discussion and proposed modifications</h2>
<p>The dominated plant interception is computed in two separate computations, one for the sunlit component, and one for the shaded component, and interception is then weighted by their relative surface. The dominant plant is considered having 100% of its surface that is sunlit, so all this computation is made only for its sunlit part.</p>
<p>The radiation above the dominant plant (<code>trg</code>) is the global radiation, but the radiation above the dominated plant (also <code>trg</code>) is computed as: <span class="math inline">\(trg=trg\cdot rsoleil\)</span></p>
<p>where <code>rsoleil</code> is the average proportion of light intercepted by the sunlit area of the plane below the dominant plant.</p>
<p>This computation is only right for the sunlit component of the dominated plant. A modification is proposed, discussed and tested on Chapter <a href="trg.html#trg">3</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="trg.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["Postdoc_steps.pdf", "Postdoc_steps.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
